<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ainstein SEO Toolkit - Data Model</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .mermaid { background: #1e293b; border-radius: 8px; padding: 16px; }
        .mermaid svg { max-width: 100%; }
        details summary { cursor: pointer; }
        details summary::-webkit-details-marker { display: none; }
        .pk { color: #f59e0b; font-weight: 600; }
        .fk { color: #3b82f6; font-weight: 600; }
        @media print {
            body { background: white !important; color: black !important; font-size: 10px; }
            nav, .no-print { display: none !important; }
            .mermaid { background: #f1f5f9 !important; }
            details { break-inside: avoid; }
            details[open] summary ~ * { display: block !important; }
            h2 { break-before: page; }
            .print-break { break-before: page; }
        }
    </style>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            er: { useMaxWidth: true, layoutDirection: 'TB' }
        });
    </script>
</head>
<body class="bg-slate-900 text-slate-200 min-h-screen">

<!-- Navigation -->
<nav class="fixed top-0 left-0 w-64 h-full bg-slate-800 border-r border-slate-700 overflow-y-auto z-50 no-print">
    <div class="p-4 border-b border-slate-700">
        <h1 class="text-lg font-bold text-white">Ainstein Data Model</h1>
        <p class="text-xs text-slate-400 mt-1">~70 tabelle &middot; 7 moduli</p>
    </div>
    <div class="p-3 space-y-1 text-sm">
        <a href="#overview" class="block px-3 py-1.5 rounded hover:bg-slate-700 text-slate-300">Panoramica Generale</a>
        <div class="pt-2 pb-1 px-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">Core</div>
        <a href="#core" class="block px-3 py-1.5 rounded hover:bg-slate-700 text-slate-300">Tabelle Core (12)</a>
        <div class="pt-2 pb-1 px-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">Moduli</div>
        <a href="#aic" class="block px-3 py-1.5 rounded hover:bg-slate-700 text-amber-400">AI Content (aic_)</a>
        <a href="#sa" class="block px-3 py-1.5 rounded hover:bg-slate-700 text-emerald-400">SEO Audit (sa_)</a>
        <a href="#st" class="block px-3 py-1.5 rounded hover:bg-slate-700 text-blue-400">SEO Tracking (st_)</a>
        <a href="#kr" class="block px-3 py-1.5 rounded hover:bg-slate-700 text-purple-400">Keyword Research (kr_)</a>
        <a href="#il" class="block px-3 py-1.5 rounded hover:bg-slate-700 text-cyan-400">Internal Links (il_)</a>
        <a href="#ga" class="block px-3 py-1.5 rounded hover:bg-slate-700 text-rose-400">Ads Analyzer (ga_)</a>
    </div>
</nav>

<!-- Main Content -->
<main class="ml-64 p-8 max-w-6xl">

    <!-- Header -->
    <div class="mb-12">
        <h1 class="text-3xl font-bold text-white mb-2">Ainstein SEO Toolkit &mdash; Data Model</h1>
        <p class="text-slate-400">Documentazione completa dello schema database. Generato il <strong class="text-slate-300">13 Febbraio 2026</strong>.</p>
        <div class="flex gap-4 mt-4 text-sm">
            <span class="px-3 py-1 bg-slate-800 rounded-full border border-slate-700">~70 tabelle</span>
            <span class="px-3 py-1 bg-slate-800 rounded-full border border-slate-700">7 moduli</span>
            <span class="px-3 py-1 bg-slate-800 rounded-full border border-slate-700">MySQL 8.0 / InnoDB</span>
            <span class="px-3 py-1 bg-slate-800 rounded-full border border-slate-700">utf8mb4</span>
        </div>
        <div class="mt-4 flex gap-3 text-xs">
            <span class="pk">&#9679; PK = Primary Key</span>
            <span class="fk">&#9679; FK = Foreign Key</span>
            <span class="text-slate-400">&#9679; UK = Unique Key</span>
        </div>
    </div>

    <!-- ==================== OVERVIEW ==================== -->
    <section id="overview" class="mb-16">
        <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-2">
            <svg class="w-6 h-6 text-primary-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2 1 3 3 3h10c2 0 3-1 3-3V7c0-2-1-3-3-3H7c-2 0-3 1-3 3z"/></svg>
            Panoramica Generale
        </h2>
        <p class="text-slate-400 mb-6">Relazioni principali tra la tabella <code class="text-amber-400">users</code> e le tabelle progetto di ogni modulo.</p>
        <div class="mermaid">
erDiagram
    users ||--o{ aic_projects : "possiede"
    users ||--o{ sa_projects : "possiede"
    users ||--o{ st_projects : "possiede"
    users ||--o{ kr_projects : "possiede"
    users ||--o{ il_projects : "possiede"
    users ||--o{ ga_projects : "possiede"
    users ||--o{ credit_transactions : "genera"
    users ||--o{ usage_log : "registra"
    users ||--o{ subscriptions : "sottoscrive"
    subscriptions }o--|| plans : "piano"
    users {
        int id PK
        varchar email UK
        varchar name
        enum role "admin/user"
        decimal credits
    }
    plans {
        int id PK
        varchar slug UK
        int credits_monthly
        decimal price_monthly
    }
        </div>
    </section>

    <!-- ==================== CORE ==================== -->
    <section id="core" class="mb-16 print-break">
        <h2 class="text-2xl font-bold text-white mb-6">Tabelle Core</h2>
        <p class="text-slate-400 mb-6">Tabelle condivise dall'intero framework: autenticazione, crediti, piani, logging.</p>

        <div class="mermaid">
erDiagram
    users ||--o{ credit_transactions : "movimenti"
    users ||--o{ usage_log : "utilizzo"
    users ||--o{ subscriptions : "abbonamenti"
    subscriptions }o--|| plans : "piano"
    users ||--o{ ai_logs : "log AI"
    settings ||--o{ users : "updated_by"
    users {
        int id PK
        varchar email UK
        varchar password
        varchar name
        enum role
        decimal credits
        boolean is_active
    }
    credit_transactions {
        int id PK
        int user_id FK
        decimal amount
        enum type
        varchar description
        decimal balance_after
    }
    usage_log {
        int id PK
        int user_id FK
        varchar module_slug
        varchar action
        decimal credits_used
    }
    plans {
        int id PK
        varchar slug UK
        int credits_monthly
        decimal price_monthly
        decimal price_yearly
        json features
    }
    subscriptions {
        int id PK
        int user_id FK
        int plan_id FK
        enum status
        decimal credits_remaining
    }
    settings {
        int id PK
        varchar key_name UK
        text value
        boolean is_secret
    }
    modules {
        int id PK
        varchar slug UK
        varchar name
        boolean is_active
        json settings
    }
    ai_logs {
        int id PK
        int user_id FK
        varchar module_slug
        varchar provider
        varchar model
        int tokens_total
        decimal estimated_cost
    }
        </div>

        <!-- users -->
        <details class="mt-6 bg-slate-800 rounded-lg border border-slate-700">
            <summary class="p-4 font-semibold text-white flex justify-between items-center">
                users
                <span class="text-xs text-slate-400">12 colonne</span>
            </summary>
            <div class="p-4 border-t border-slate-700 overflow-x-auto">
                <table class="w-full text-sm">
                    <thead><tr class="text-left text-slate-400 border-b border-slate-700"><th class="pb-2">Colonna</th><th class="pb-2">Tipo</th><th class="pb-2">Note</th></tr></thead>
                    <tbody class="text-slate-300">
                        <tr><td class="py-1 pk">id</td><td>INT AUTO_INCREMENT</td><td>PRIMARY KEY</td></tr>
                        <tr><td class="py-1">email</td><td>VARCHAR(255)</td><td>UNIQUE</td></tr>
                        <tr><td class="py-1">password</td><td>VARCHAR(255)</td><td></td></tr>
                        <tr><td class="py-1">name</td><td>VARCHAR(255)</td><td></td></tr>
                        <tr><td class="py-1">role</td><td>ENUM('admin','user')</td><td>DEFAULT 'user'</td></tr>
                        <tr><td class="py-1">credits</td><td>DECIMAL(10,2)</td><td>DEFAULT 50.00</td></tr>
                        <tr><td class="py-1">is_active</td><td>TINYINT(1)</td><td>DEFAULT 1</td></tr>
                        <tr><td class="py-1">remember_token</td><td>VARCHAR(255)</td><td></td></tr>
                        <tr><td class="py-1">created_at</td><td>TIMESTAMP</td><td></td></tr>
                        <tr><td class="py-1">updated_at</td><td>TIMESTAMP</td><td>ON UPDATE</td></tr>
                    </tbody>
                </table>
            </div>
        </details>

        <!-- credit_transactions -->
        <details class="mt-3 bg-slate-800 rounded-lg border border-slate-700">
            <summary class="p-4 font-semibold text-white flex justify-between items-center">
                credit_transactions
                <span class="text-xs text-slate-400">8 colonne</span>
            </summary>
            <div class="p-4 border-t border-slate-700 overflow-x-auto">
                <table class="w-full text-sm">
                    <thead><tr class="text-left text-slate-400 border-b border-slate-700"><th class="pb-2">Colonna</th><th class="pb-2">Tipo</th><th class="pb-2">Note</th></tr></thead>
                    <tbody class="text-slate-300">
                        <tr><td class="py-1 pk">id</td><td>INT AUTO_INCREMENT</td><td>PRIMARY KEY</td></tr>
                        <tr><td class="py-1 fk">user_id</td><td>INT</td><td>FK &rarr; users(id) CASCADE</td></tr>
                        <tr><td class="py-1">amount</td><td>DECIMAL(10,2)</td><td></td></tr>
                        <tr><td class="py-1">type</td><td>ENUM('purchase','subscription','manual','usage','bonus')</td><td></td></tr>
                        <tr><td class="py-1">description</td><td>VARCHAR(255)</td><td></td></tr>
                        <tr><td class="py-1 fk">admin_id</td><td>INT</td><td>FK &rarr; users(id) SET NULL</td></tr>
                        <tr><td class="py-1">balance_after</td><td>DECIMAL(10,2)</td><td></td></tr>
                        <tr><td class="py-1">created_at</td><td>TIMESTAMP</td><td></td></tr>
                    </tbody>
                </table>
            </div>
        </details>

        <!-- usage_log -->
        <details class="mt-3 bg-slate-800 rounded-lg border border-slate-700">
            <summary class="p-4 font-semibold text-white flex justify-between items-center">
                usage_log
                <span class="text-xs text-slate-400">6 colonne</span>
            </summary>
            <div class="p-4 border-t border-slate-700 overflow-x-auto">
                <table class="w-full text-sm">
                    <thead><tr class="text-left text-slate-400 border-b border-slate-700"><th class="pb-2">Colonna</th><th class="pb-2">Tipo</th><th class="pb-2">Note</th></tr></thead>
                    <tbody class="text-slate-300">
                        <tr><td class="py-1 pk">id</td><td>INT AUTO_INCREMENT</td><td>PRIMARY KEY</td></tr>
                        <tr><td class="py-1 fk">user_id</td><td>INT</td><td>FK &rarr; users(id) CASCADE</td></tr>
                        <tr><td class="py-1">module_slug</td><td>VARCHAR(100)</td><td></td></tr>
                        <tr><td class="py-1">action</td><td>VARCHAR(100)</td><td></td></tr>
                        <tr><td class="py-1">credits_used</td><td>DECIMAL(5,2)</td><td></td></tr>
                        <tr><td class="py-1">metadata</td><td>JSON</td><td></td></tr>
                        <tr><td class="py-1">created_at</td><td>TIMESTAMP</td><td></td></tr>
                    </tbody>
                </table>
            </div>
        </details>

        <!-- plans, subscriptions, settings, modules, ai_logs, password_resets -->
        <details class="mt-3 bg-slate-800 rounded-lg border border-slate-700">
            <summary class="p-4 font-semibold text-white flex justify-between items-center">
                plans
                <span class="text-xs text-slate-400">9 colonne</span>
            </summary>
            <div class="p-4 border-t border-slate-700 overflow-x-auto">
                <table class="w-full text-sm">
                    <thead><tr class="text-left text-slate-400 border-b border-slate-700"><th class="pb-2">Colonna</th><th class="pb-2">Tipo</th><th class="pb-2">Note</th></tr></thead>
                    <tbody class="text-slate-300">
                        <tr><td class="py-1 pk">id</td><td>INT AUTO_INCREMENT</td><td>PRIMARY KEY</td></tr>
                        <tr><td class="py-1">name</td><td>VARCHAR(100)</td><td></td></tr>
                        <tr><td class="py-1">slug</td><td>VARCHAR(100)</td><td>UNIQUE</td></tr>
                        <tr><td class="py-1">credits_monthly</td><td>INT</td><td></td></tr>
                        <tr><td class="py-1">price_monthly</td><td>DECIMAL(10,2)</td><td></td></tr>
                        <tr><td class="py-1">price_yearly</td><td>DECIMAL(10,2)</td><td></td></tr>
                        <tr><td class="py-1">is_active</td><td>TINYINT(1)</td><td>DEFAULT 1</td></tr>
                        <tr><td class="py-1">features</td><td>JSON</td><td></td></tr>
                        <tr><td class="py-1">created_at</td><td>TIMESTAMP</td><td></td></tr>
                    </tbody>
                </table>
            </div>
        </details>

        <details class="mt-3 bg-slate-800 rounded-lg border border-slate-700">
            <summary class="p-4 font-semibold text-white flex justify-between items-center">
                subscriptions
                <span class="text-xs text-slate-400">8 colonne</span>
            </summary>
            <div class="p-4 border-t border-slate-700 overflow-x-auto">
                <table class="w-full text-sm">
                    <thead><tr class="text-left text-slate-400 border-b border-slate-700"><th class="pb-2">Colonna</th><th class="pb-2">Tipo</th><th class="pb-2">Note</th></tr></thead>
                    <tbody class="text-slate-300">
                        <tr><td class="py-1 pk">id</td><td>INT AUTO_INCREMENT</td><td>PRIMARY KEY</td></tr>
                        <tr><td class="py-1 fk">user_id</td><td>INT</td><td>FK &rarr; users(id) CASCADE</td></tr>
                        <tr><td class="py-1 fk">plan_id</td><td>INT</td><td>FK &rarr; plans(id) CASCADE</td></tr>
                        <tr><td class="py-1">status</td><td>ENUM('active','cancelled','expired')</td><td></td></tr>
                        <tr><td class="py-1">credits_remaining</td><td>DECIMAL(10,2)</td><td></td></tr>
                        <tr><td class="py-1">current_period_start</td><td>DATE</td><td></td></tr>
                        <tr><td class="py-1">current_period_end</td><td>DATE</td><td></td></tr>
                        <tr><td class="py-1">stripe_subscription_id</td><td>VARCHAR(255)</td><td></td></tr>
                    </tbody>
                </table>
            </div>
        </details>

        <details class="mt-3 bg-slate-800 rounded-lg border border-slate-700">
            <summary class="p-4 font-semibold text-white flex justify-between items-center">
                settings &middot; modules &middot; ai_logs &middot; password_resets
                <span class="text-xs text-slate-400">Altre tabelle core</span>
            </summary>
            <div class="p-4 border-t border-slate-700 space-y-4 text-sm text-slate-300">
                <div><strong class="text-white">settings</strong>: id(PK), key_name(UK), value, is_secret, updated_by(FK&rarr;users), updated_at</div>
                <div><strong class="text-white">modules</strong>: id(PK), slug(UK), name, description, version, is_active, settings(JSON), created_at, updated_at</div>
                <div><strong class="text-white">ai_logs</strong>: id(PK), user_id(FK), module_slug, provider, model, request_payload, response_payload, tokens_input, tokens_output, tokens_total(GENERATED), duration_ms, status, error_message, fallback_from, estimated_cost, credits_used, created_at</div>
                <div><strong class="text-white">password_resets</strong>: id(PK), email, token, created_at</div>
            </div>
        </details>
    </section>

    <!-- ==================== AI CONTENT ==================== -->
    <section id="aic" class="mb-16 print-break">
        <h2 class="text-2xl font-bold text-amber-400 mb-6">AI Content Generator (aic_)</h2>
        <p class="text-slate-400 mb-6">11 tabelle. Generazione articoli SEO con SERP analysis, brief AI e WordPress integration.</p>

        <div class="mermaid">
erDiagram
    aic_projects ||--o{ aic_keywords : "contiene"
    aic_projects ||--o{ aic_meta_tags : "meta tags"
    aic_projects ||--o{ aic_internal_links_pool : "link pool"
    aic_projects ||--o{ aic_process_jobs : "jobs"
    aic_keywords ||--o{ aic_serp_results : "SERP"
    aic_keywords ||--o{ aic_paa_questions : "PAA"
    aic_keywords ||--o{ aic_articles : "articolo"
    aic_articles ||--o{ aic_sources : "fonti"
    aic_articles ||--o{ aic_wp_publish_log : "pubblicazione"
    aic_wp_sites ||--o{ aic_wp_publish_log : "sito WP"
    aic_projects {
        int id PK
        int user_id FK
        varchar name
        json settings
    }
    aic_keywords {
        int id PK
        int project_id FK
        varchar keyword
        varchar language
    }
    aic_articles {
        int id PK
        int keyword_id FK
        varchar title
        longtext content
        enum status
        int credits_used
    }
    aic_meta_tags {
        int id PK
        int project_id FK
        varchar url
        varchar generated_title
        varchar generated_desc
        enum status
    }
        </div>

        <details class="mt-6 bg-slate-800 rounded-lg border border-amber-900/50">
            <summary class="p-4 font-semibold text-white">aic_projects</summary>
            <div class="p-4 border-t border-slate-700 text-sm text-slate-300">
                id(PK), user_id(FK&rarr;users), name, description, default_language, default_location, settings(JSON), created_at, updated_at
            </div>
        </details>
        <details class="mt-2 bg-slate-800 rounded-lg border border-amber-900/50">
            <summary class="p-4 font-semibold text-white">aic_keywords</summary>
            <div class="p-4 border-t border-slate-700 text-sm text-slate-300">
                id(PK), user_id(FK&rarr;users), project_id(FK&rarr;aic_projects), keyword, language, location, serp_extracted_at, created_at
            </div>
        </details>
        <details class="mt-2 bg-slate-800 rounded-lg border border-amber-900/50">
            <summary class="p-4 font-semibold text-white">aic_articles</summary>
            <div class="p-4 border-t border-slate-700 text-sm text-slate-300">
                id(PK), user_id(FK&rarr;users), project_id, keyword_id(FK&rarr;aic_keywords), title, content(LONGTEXT), meta_description, word_count, status(draft/generating/ready/published/failed), brief_data(JSON), ai_model, generation_time_ms, credits_used, published_at, wp_site_id(FK&rarr;aic_wp_sites), wp_post_id, published_url, created_at, updated_at
            </div>
        </details>
        <details class="mt-2 bg-slate-800 rounded-lg border border-amber-900/50">
            <summary class="p-4 font-semibold text-white">aic_serp_results</summary>
            <div class="p-4 border-t border-slate-700 text-sm text-slate-300">
                id(PK), keyword_id(FK&rarr;aic_keywords CASCADE), position, title, url, snippet, domain, created_at
            </div>
        </details>
        <details class="mt-2 bg-slate-800 rounded-lg border border-amber-900/50">
            <summary class="p-4 font-semibold text-white">aic_paa_questions</summary>
            <div class="p-4 border-t border-slate-700 text-sm text-slate-300">
                id(PK), keyword_id(FK&rarr;aic_keywords CASCADE), question, snippet, position, created_at
            </div>
        </details>
        <details class="mt-2 bg-slate-800 rounded-lg border border-amber-900/50">
            <summary class="p-4 font-semibold text-white">aic_sources</summary>
            <div class="p-4 border-t border-slate-700 text-sm text-slate-300">
                id(PK), article_id(FK&rarr;aic_articles CASCADE), url, title, content_extracted(LONGTEXT), headings_json(JSON), word_count, is_custom, scrape_status(pending/success/failed), error_message, scraped_at, created_at
            </div>
        </details>
        <details class="mt-2 bg-slate-800 rounded-lg border border-amber-900/50">
            <summary class="p-4 font-semibold text-white">aic_wp_sites &middot; aic_wp_publish_log &middot; aic_meta_tags &middot; aic_internal_links_pool &middot; aic_process_jobs</summary>
            <div class="p-4 border-t border-slate-700 text-sm text-slate-300 space-y-3">
                <div><strong class="text-white">aic_wp_sites</strong>: id(PK), user_id(FK), name, url, api_key, is_active, last_sync_at, categories_cache(JSON)</div>
                <div><strong class="text-white">aic_wp_publish_log</strong>: id(PK), article_id(FK), wp_site_id(FK), wp_post_id, status(success/failed), response_data(JSON)</div>
                <div><strong class="text-white">aic_meta_tags</strong>: id(PK), project_id(FK), user_id, url(UK con project), original_title, original_h1, current_meta_title/desc, generated_title/desc, scraped_content, status(pending/scraped/generated/approved/published/error), wp_site_id, wp_post_id, wp_post_type, scrape/generation/publish_error, timestamps</div>
                <div><strong class="text-white">aic_internal_links_pool</strong>: id(PK), project_id(FK), url(UK con project), title, description, sitemap_source, scrape_status, is_active</div>
                <div><strong class="text-white">aic_process_jobs</strong>: id(PK), project_id(FK), user_id(FK), type(cron/manual), status(pending/running/completed/error/cancelled), keywords_requested/completed/failed, current_queue_id, current_keyword, current_step, articles_generated, credits_used, error_message, started/completed_at</div>
            </div>
        </details>
    </section>

    <!-- ==================== SEO AUDIT ==================== -->
    <section id="sa" class="mb-16 print-break">
        <h2 class="text-2xl font-bold text-emerald-400 mb-6">SEO Audit (sa_)</h2>
        <p class="text-slate-400 mb-6">12 tabelle. Crawling sito, rilevamento 50+ problemi, integrazione GSC, analisi AI.</p>

        <div class="mermaid">
erDiagram
    sa_projects ||--o{ sa_pages : "pagine"
    sa_projects ||--o{ sa_issues : "problemi"
    sa_projects ||--|| sa_site_config : "config"
    sa_projects ||--|| sa_gsc_connections : "GSC OAuth"
    sa_projects ||--o{ sa_gsc_performance : "performance"
    sa_projects ||--o{ sa_gsc_coverage : "coverage"
    sa_projects ||--o{ sa_gsc_core_web_vitals : "CWV"
    sa_projects ||--o{ sa_ai_analyses : "analisi AI"
    sa_pages ||--o{ sa_issues : "problemi pagina"
    sa_projects {
        int id PK
        int user_id FK
        varchar name
        varchar base_url
        int health_score
        enum status
    }
    sa_pages {
        int id PK
        int project_id FK
        varchar url
        int status_code
        varchar title
        int word_count
    }
    sa_issues {
        int id PK
        int project_id FK
        int page_id FK
        varchar category
        enum severity
        varchar title
    }
        </div>

        <details class="mt-6 bg-slate-800 rounded-lg border border-emerald-900/50">
            <summary class="p-4 font-semibold text-white">sa_projects</summary>
            <div class="p-4 border-t border-slate-700 text-sm text-slate-300">
                id(PK), user_id(FK&rarr;users), name, base_url, crawl_mode(sitemap/spider/both), max_pages, status(pending/crawling/analyzing/completed/failed), pages_found, pages_crawled, issues_count, health_score, gsc_connected, gsc_property, created_at, updated_at, completed_at
            </div>
        </details>
        <details class="mt-2 bg-slate-800 rounded-lg border border-emerald-900/50">
            <summary class="p-4 font-semibold text-white">sa_pages <span class="text-xs text-slate-400 ml-2">~30 colonne</span></summary>
            <div class="p-4 border-t border-slate-700 text-sm text-slate-300">
                id(PK), project_id(FK), url, status_code, load_time_ms, content_length, title, title_length, meta_description, meta_description_length, meta_robots, canonical_url, og_title/description/image, h1_count..h6_count, word_count, images_count, images_without_alt, images_data(JSON), internal/external/broken/nofollow_links_count, links_data(JSON), has_schema, schema_types(JSON), hreflang_tags(JSON), is_indexable, indexability_reason, html_content(LONGTEXT), crawled_at
            </div>
        </details>
        <details class="mt-2 bg-slate-800 rounded-lg border border-emerald-900/50">
            <summary class="p-4 font-semibold text-white">sa_issues</summary>
            <div class="p-4 border-t border-slate-700 text-sm text-slate-300">
                id(PK), project_id(FK), page_id(FK&rarr;sa_pages CASCADE), category, issue_type, severity(critical/warning/notice/info), title, description, affected_element, recommendation, source(crawler/gsc), created_at
            </div>
        </details>
        <details class="mt-2 bg-slate-800 rounded-lg border border-emerald-900/50">
            <summary class="p-4 font-semibold text-white">sa_gsc_* &middot; sa_site_config &middot; sa_ai_analyses &middot; sa_activity_logs</summary>
            <div class="p-4 border-t border-slate-700 text-sm text-slate-300 space-y-3">
                <div><strong class="text-white">sa_gsc_connections</strong>: id(PK), project_id(FK UK), user_id(FK), access_token, refresh_token, token_expires_at, property_url, property_type(URL_PREFIX/DOMAIN), is_active, last_sync_at</div>
                <div><strong class="text-white">sa_gsc_performance</strong>: id(PK), project_id(FK), date, query, page, device, country, clicks, impressions, ctr, position</div>
                <div><strong class="text-white">sa_gsc_coverage</strong>: id(PK), project_id(FK), url, coverage_state(11 valori ENUM), verdict(PASS/NEUTRAL/FAIL), robots_txt_state, indexing_state, google/user_canonical, last_crawl_time</div>
                <div><strong class="text-white">sa_gsc_core_web_vitals</strong>: id(PK), project_id(FK), form_factor(PHONE/DESKTOP), metric_type(LCP/INP/CLS), good/needs_improvement/poor_percent, p75_value, p75_unit, date_range</div>
                <div><strong class="text-white">sa_gsc_mobile_usability</strong>: id(PK), project_id(FK), url, issue_type(8 ENUM values), severity</div>
                <div><strong class="text-white">sa_gsc_sync_log</strong>: id(PK), project_id(FK), sync_type, date_range, records_imported, status, error_message</div>
                <div><strong class="text-white">sa_site_config</strong>: id(PK), project_id(FK UK), robots_txt, robots_allows/disallows(JSON), sitemap_urls(JSON), has_sitemap, has_robots, is_https, ssl_valid</div>
                <div><strong class="text-white">sa_ai_analyses</strong>: id(PK), project_id(FK), type(overview/category), category, content(LONGTEXT), credits_used</div>
                <div><strong class="text-white">sa_activity_logs</strong>: id(PK), project_id(FK), user_id(FK), action, details(JSON)</div>
            </div>
        </details>
    </section>

    <!-- ==================== SEO TRACKING ==================== -->
    <section id="st" class="mb-16 print-break">
        <h2 class="text-2xl font-bold text-blue-400 mb-6">SEO Tracking (st_)</h2>
        <p class="text-slate-400 mb-6">16+ tabelle. Monitoraggio posizioni, GSC/GA4 integration, alert, report AI, rank checking.</p>

        <div class="mermaid">
erDiagram
    st_projects ||--o{ st_keywords : "keyword"
    st_projects ||--|| st_gsc_connections : "GSC"
    st_projects ||--|| st_ga4_connections : "GA4"
    st_projects ||--o{ st_gsc_data : "dati GSC"
    st_projects ||--o{ st_ga4_data : "dati GA4"
    st_projects ||--o{ st_alerts : "alert"
    st_projects ||--|| st_alert_settings : "config alert"
    st_projects ||--o{ st_ai_reports : "report"
    st_projects ||--o{ st_rank_jobs : "rank jobs"
    st_keywords ||--o{ st_keyword_positions : "posizioni"
    st_keywords ||--o{ st_gsc_data : "dati query"
    st_keywords ||--o{ st_keyword_revenue : "revenue"
    st_rank_jobs ||--o{ st_rank_queue : "coda"
    st_projects {
        int id PK
        int user_id FK
        varchar domain
        boolean gsc_connected
        boolean ga4_connected
    }
    st_keywords {
        int id PK
        int project_id FK
        varchar keyword UK
        enum priority
        decimal last_position
    }
    st_keyword_positions {
        bigint id PK
        int keyword_id FK
        date date
        decimal avg_position
        int total_clicks
    }
        </div>

        <details class="mt-6 bg-slate-800 rounded-lg border border-blue-900/50">
            <summary class="p-4 font-semibold text-white">st_projects</summary>
            <div class="p-4 border-t border-slate-700 text-sm text-slate-300">
                id(PK), user_id(FK), name, domain, gsc_connected, ga4_connected, sync_enabled, last_sync_at, sync_status, ai_reports_enabled, weekly_report_day/time, monthly_report_day, notification_emails(JSON), data_retention_months, created_at, updated_at
            </div>
        </details>
        <details class="mt-2 bg-slate-800 rounded-lg border border-blue-900/50">
            <summary class="p-4 font-semibold text-white">st_keywords</summary>
            <div class="p-4 border-t border-slate-700 text-sm text-slate-300">
                id(PK), project_id(FK), keyword(UK con project), keyword_group, is_brand, target_url, priority(high/medium/low), alert_position_change, alert_enabled, last_position, last_clicks, last_impressions, last_ctr, last_updated_at, created_at
            </div>
        </details>
        <details class="mt-2 bg-slate-800 rounded-lg border border-blue-900/50">
            <summary class="p-4 font-semibold text-white">st_gsc_data <span class="text-xs text-slate-400 ml-2">BIGINT PK - tabella ad alto volume</span></summary>
            <div class="p-4 border-t border-slate-700 text-sm text-slate-300">
                id(BIGINT PK), project_id(FK), date, query, page, country, device(DESKTOP/MOBILE/TABLET/ALL), clicks, impressions, ctr, position, keyword_id(FK nullable). UK(project, date, query, page, country, device)
            </div>
        </details>
        <details class="mt-2 bg-slate-800 rounded-lg border border-blue-900/50">
            <summary class="p-4 font-semibold text-white">st_keyword_positions &middot; st_keyword_revenue</summary>
            <div class="p-4 border-t border-slate-700 text-sm text-slate-300 space-y-3">
                <div><strong class="text-white">st_keyword_positions</strong> (BIGINT PK): project_id(FK), keyword_id(FK), date, avg_position, best_position, total_clicks, total_impressions, avg_ctr, position/clicks/impressions_change, top_pages(JSON), country_data(JSON). UK(keyword_id, date)</div>
                <div><strong class="text-white">st_keyword_revenue</strong> (BIGINT PK): project_id(FK), keyword_id(FK nullable), date, query, landing_page, clicks, impressions, position, sessions, revenue, purchases, add_to_carts, revenue_per_click, conversion_rate</div>
            </div>
        </details>
        <details class="mt-2 bg-slate-800 rounded-lg border border-blue-900/50">
            <summary class="p-4 font-semibold text-white">st_gsc_daily &middot; st_ga4_data &middot; st_ga4_daily &middot; Connessioni &middot; Alert &middot; Report &middot; Sync &middot; Rank</summary>
            <div class="p-4 border-t border-slate-700 text-sm text-slate-300 space-y-3">
                <div><strong class="text-white">st_gsc_daily</strong>: project_id(FK), date(UK), total_clicks, total_impressions, avg_ctr, avg_position, unique_queries, unique_pages, changes</div>
                <div><strong class="text-white">st_ga4_data</strong> (BIGINT): project_id(FK), date, landing_page, source_medium, country, device, sessions, users, new_users, engagement metrics, e-commerce metrics (purchases, revenue)</div>
                <div><strong class="text-white">st_ga4_daily</strong>: project_id(FK), date(UK), traffic + engagement + e-commerce aggregati giornalieri</div>
                <div><strong class="text-white">st_gsc_connections</strong>: project_id(FK UK), OAuth tokens, property_url, property_type, is_active, last_sync_at</div>
                <div><strong class="text-white">st_ga4_connections</strong>: project_id(FK UK), service_account_json, property_id, property_name, is_active</div>
                <div><strong class="text-white">st_alerts</strong>: project_id(FK), alert_type(9 valori), severity, title, message, keyword_id(FK), previous/current_value, change_percent, ai_analysis, ai_suggestion, status(new/read/actioned/dismissed)</div>
                <div><strong class="text-white">st_alert_settings</strong>: project_id(FK UK), position/traffic/revenue/anomaly alert config, email_enabled, email_frequency</div>
                <div><strong class="text-white">st_ai_reports</strong>: project_id(FK), report_type(6 valori), date_from/to, title, summary, content(LONGTEXT), metrics_snapshot(JSON), credits_used, email config, is_scheduled</div>
                <div><strong class="text-white">st_sync_log</strong>: project_id(FK), sync_type(gsc/ga4/full), date range, records_fetched/inserted/updated, status, duration_seconds</div>
                <div><strong class="text-white">st_rank_jobs</strong>: project_id(FK), user_id(FK), type(cron/manual), status, keywords_requested/completed/failed/found, current_keyword, avg_position, credits_used</div>
                <div><strong class="text-white">st_rank_queue</strong>: project_id(FK), keyword_id(FK), keyword, target_domain, location_code, device, status, scheduled_at, result_position, result_url, job_id</div>
            </div>
        </details>
    </section>

    <!-- ==================== KEYWORD RESEARCH ==================== -->
    <section id="kr" class="mb-16 print-break">
        <h2 class="text-2xl font-bold text-purple-400 mb-6">AI Keyword Research (kr_)</h2>
        <p class="text-slate-400 mb-6">4 tabelle. Research guidata con clustering AI e architettura sito.</p>

        <div class="mermaid">
erDiagram
    kr_projects ||--o{ kr_researches : "ricerche"
    kr_researches ||--o{ kr_clusters : "cluster"
    kr_researches ||--o{ kr_keywords : "keyword"
    kr_clusters ||--o{ kr_keywords : "keyword del cluster"
    kr_projects {
        int id PK
        int user_id FK
        varchar name
        varchar default_location
    }
    kr_researches {
        int id PK
        int project_id FK
        enum type "research/architecture"
        enum status
        json brief
        json ai_response
    }
    kr_clusters {
        int id PK
        int research_id FK
        varchar name
        varchar main_keyword
        varchar intent
    }
    kr_keywords {
        int id PK
        int research_id FK
        int cluster_id FK
        varchar text
        int volume
        varchar intent
    }
        </div>

        <details class="mt-6 bg-slate-800 rounded-lg border border-purple-900/50">
            <summary class="p-4 font-semibold text-white">Tutte le tabelle kr_</summary>
            <div class="p-4 border-t border-slate-700 text-sm text-slate-300 space-y-3">
                <div><strong class="text-white">kr_projects</strong>: id(PK), user_id, name, description, default_location, default_language, created_at, updated_at</div>
                <div><strong class="text-white">kr_researches</strong>: id(PK), project_id(FK), user_id, type(research/architecture), status(draft/collecting/analyzing/completed/error), brief(JSON), raw_keywords_count, filtered_keywords_count, ai_response(JSON), strategy_note, credits_used, api_time_ms, ai_time_ms</div>
                <div><strong class="text-white">kr_clusters</strong>: id(PK), research_id(FK), name, main_keyword, main_volume, total_volume, keywords_count, intent, note, suggested_url, suggested_h1, sort_order</div>
                <div><strong class="text-white">kr_keywords</strong>: id(PK), research_id(FK), cluster_id(FK), text, volume, competition_level, competition_index, low_bid, high_bid, trend, intent, is_main, is_excluded, source</div>
            </div>
        </details>
    </section>

    <!-- ==================== INTERNAL LINKS ==================== -->
    <section id="il" class="mb-16 print-break">
        <h2 class="text-2xl font-bold text-cyan-400 mb-6">Internal Links (il_)</h2>
        <p class="text-slate-400 mb-6">8 tabelle. Analisi struttura link interni, rilevamento pagine orfane, snapshot storici.</p>

        <div class="mermaid">
erDiagram
    il_projects ||--o{ il_urls : "URL"
    il_projects ||--|| il_project_stats : "stats"
    il_projects ||--o{ il_scrape_sessions : "sessioni"
    il_projects ||--o{ il_snapshots : "snapshot"
    il_urls ||--o{ il_internal_links : "link uscenti"
    il_snapshots ||--o{ il_snapshot_links : "link salvati"
    il_projects {
        int id PK
        int user_id FK
        varchar name
        varchar base_url
    }
    il_urls {
        int id PK
        int project_id FK
        varchar url UK
        enum status
    }
    il_internal_links {
        int id PK
        int source_url_id FK
        varchar destination_url
        varchar anchor_text
        tinyint ai_relevance_score
        enum ai_juice_flow
    }
        </div>

        <details class="mt-6 bg-slate-800 rounded-lg border border-cyan-900/50">
            <summary class="p-4 font-semibold text-white">Tutte le tabelle il_</summary>
            <div class="p-4 border-t border-slate-700 text-sm text-slate-300 space-y-3">
                <div><strong class="text-white">il_projects</strong>: id(PK), user_id(FK), name, base_url, css_selector, html_block_regex, scrape_delay, user_agent, status, created_at</div>
                <div><strong class="text-white">il_urls</strong>: id(PK), project_id(FK), url(UK con project), keyword, raw_html, content_html, http_status, scraped_at, status(pending/scraping/scraped/error/no_content), error_message</div>
                <div><strong class="text-white">il_internal_links</strong>: id(PK), project_id(FK), source_url_id(FK&rarr;il_urls), destination_url, anchor_text, anchor_text_clean, link_position, source_block, is_internal, is_valid, ai_relevance_score(1-10), ai_anchor_quality(1-10), ai_juice_flow(optimal/good/weak/poor/orphan), ai_notes, ai_suggestions, analyzed_at</div>
                <div><strong class="text-white">il_scrape_sessions</strong>: id(PK), project_id(FK), status(running/paused/completed/stopped), mode(pending/all), total_urls, processed_urls, error_count</div>
                <div><strong class="text-white">il_snapshots</strong>: id(PK), project_id(FK), user_id(FK), name, description, total_urls/links, internal/external_links, orphan_pages, avg_relevance_score</div>
                <div><strong class="text-white">il_snapshot_links</strong>: id(PK), snapshot_id(FK), source_url, destination_url, anchor_text, is_internal, ai_relevance_score, ai_juice_flow</div>
                <div><strong class="text-white">il_project_stats</strong>: project_id(PK FK), total_urls, scraped/error_urls, total/internal/external/analyzed_links, avg_relevance_score, orphan_pages</div>
                <div><strong class="text-white">il_activity_logs</strong>: id(PK), project_id(FK), user_id(FK), action, details(JSON)</div>
            </div>
        </details>
    </section>

    <!-- ==================== ADS ANALYZER ==================== -->
    <section id="ga" class="mb-16 print-break">
        <h2 class="text-2xl font-bold text-rose-400 mb-6">Google Ads Analyzer (ga_)</h2>
        <p class="text-slate-400 mb-6">15 tabelle. Analisi negative keywords, valutazione campagne AI, Google Ads Script integration.</p>

        <div class="mermaid">
erDiagram
    ga_projects ||--o{ ga_script_runs : "runs"
    ga_projects ||--o{ ga_analyses : "analisi"
    ga_projects ||--o{ ga_ad_groups : "ad groups"
    ga_projects ||--o{ ga_campaigns : "campagne"
    ga_projects ||--o{ ga_campaign_evaluations : "valutazioni"
    ga_ad_groups ||--o{ ga_search_terms : "search terms"
    ga_ad_groups ||--o{ ga_negative_categories : "categorie"
    ga_negative_categories ||--o{ ga_negative_keywords : "kw negative"
    ga_script_runs ||--o{ ga_campaigns : "dati campagne"
    ga_script_runs ||--o{ ga_ads : "annunci"
    ga_projects {
        int id PK
        int user_id FK
        enum type "negative-kw/campaign"
        varchar api_token UK
    }
    ga_analyses {
        int id PK
        int project_id FK
        varchar name
        enum status
    }
    ga_campaign_evaluations {
        int id PK
        int project_id FK
        enum eval_type "manual/auto"
        longtext ai_response
    }
        </div>

        <details class="mt-6 bg-slate-800 rounded-lg border border-rose-900/50">
            <summary class="p-4 font-semibold text-white">Negative Keywords: ga_projects &middot; ga_analyses &middot; ga_ad_groups &middot; ga_search_terms &middot; ga_negative_categories &middot; ga_negative_keywords &middot; ga_saved_contexts</summary>
            <div class="p-4 border-t border-slate-700 text-sm text-slate-300 space-y-3">
                <div><strong class="text-white">ga_projects</strong>: id(PK), user_id(FK), type(negative-kw/campaign), name, description, business_context, status, api_token(UK), api_token_created_at, script_config(JSON), auto_evaluate, total_terms, total_negatives_found</div>
                <div><strong class="text-white">ga_analyses</strong>: id(PK), project_id(FK), user_id(FK), name, business_context, context_mode, status, run_id(FK), total_categories/keywords, error_message, started/completed_at</div>
                <div><strong class="text-white">ga_ad_groups</strong>: id(PK), project_id(FK), run_id(FK), name, terms_count, zero_ctr_count, wasted_impressions, analysis_status, landing_url, scraped_content, extracted_context</div>
                <div><strong class="text-white">ga_search_terms</strong>: id(PK), project_id(FK), ad_group_id(FK), run_id(FK), term, match_type, clicks, impressions, ctr, cost, conversions, conversion_value, is_zero_ctr</div>
                <div><strong class="text-white">ga_negative_categories</strong>: id(PK), project_id(FK), ad_group_id(FK), analysis_id(FK), category_key, category_name, description, priority(high/medium/low), keywords_count, sort_order</div>
                <div><strong class="text-white">ga_negative_keywords</strong>: id(PK), project_id(FK), ad_group_id(FK), analysis_id(FK), category_id(FK), keyword, is_selected, suggested_match_type</div>
                <div><strong class="text-white">ga_saved_contexts</strong>: id(PK), user_id(FK), name, context(LONGTEXT)</div>
            </div>
        </details>
        <details class="mt-2 bg-slate-800 rounded-lg border border-rose-900/50">
            <summary class="p-4 font-semibold text-white">Campaign Analysis: ga_script_runs &middot; ga_campaigns &middot; ga_ads &middot; ga_extensions &middot; ga_campaign_evaluations &middot; ga_campaign_ad_groups &middot; ga_ad_group_keywords &middot; ga_auto_eval_queue</summary>
            <div class="p-4 border-t border-slate-700 text-sm text-slate-300 space-y-3">
                <div><strong class="text-white">ga_script_runs</strong>: id(PK), project_id(FK), run_type, status(received/processing/completed/error), items_received, error_message, script_version, date_range</div>
                <div><strong class="text-white">ga_campaigns</strong>: id(PK), project_id(FK), run_id(FK), campaign_id_google, campaign_name, status/type, bidding_strategy, budget, clicks, impressions, ctr, avg_cpc, cost, conversions, conversion_value, conv_rate</div>
                <div><strong class="text-white">ga_ads</strong>: id(PK), project_id(FK), run_id(FK), campaign/ad_group IDs, ad_type, headline1-3, description1-2, final_url, path1-2, status, metrics, quality_score</div>
                <div><strong class="text-white">ga_extensions</strong>: id(PK), project_id(FK), run_id(FK), extension_type, extension_text, status, clicks, impressions</div>
                <div><strong class="text-white">ga_campaign_evaluations</strong>: id(PK), project_id(FK), user_id(FK), run_id(FK), eval_type(manual/auto), previous_eval_id, name, campaigns/ads/ad_groups/keywords_evaluated, landing_pages_analyzed, ai_response(LONGTEXT), metric_deltas(JSON), campaigns_filter(JSON), status, credits_used</div>
                <div><strong class="text-white">ga_campaign_ad_groups</strong>: id(PK), project_id(FK), run_id(FK), campaign info, ad_group info, all metrics</div>
                <div><strong class="text-white">ga_ad_group_keywords</strong>: id(PK), project_id(FK), run_id(FK), campaign/ad_group info, keyword_text, match_type, status, metrics, quality_score, first_page_cpc</div>
                <div><strong class="text-white">ga_auto_eval_queue</strong>: id(PK), project_id(FK), run_id(FK UK), status(pending/processing/completed/skipped/error), skip_reason, attempts, scheduled_for, timestamps</div>
            </div>
        </details>
    </section>

    <!-- Footer -->
    <footer class="mt-16 pt-8 border-t border-slate-700 text-center text-sm text-slate-500">
        <p>Ainstein SEO Toolkit &mdash; Data Model v1.0 &mdash; Generato il 13 Febbraio 2026</p>
        <p class="mt-1">Per stampare come PDF: Ctrl+P &rarr; Salva come PDF (layout A4 Landscape consigliato)</p>
    </footer>

</main>

</body>
</html>
