<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ainstein SEO Toolkit - Data Model</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', '-apple-system', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#e6f4f8',
                            100: '#cce9f1',
                            200: '#99d3e3',
                            300: '#66bdd5',
                            400: '#33a7c7',
                            500: '#006e96',
                            600: '#005577',
                            700: '#004d69',
                            800: '#003d54',
                            900: '#002e3f',
                            950: '#001f2a',
                        },
                        secondary: {
                            50: '#e6f0f4',
                            100: '#cce1e9',
                            200: '#99c3d3',
                            300: '#66a5bd',
                            400: '#3387a7',
                            500: '#004d69',
                            600: '#003d54',
                            700: '#00313f',
                            800: '#00252f',
                            900: '#00191f',
                        },
                        accent: {
                            50: '#e6f7fc',
                            100: '#cceff9',
                            200: '#99dff3',
                            300: '#66cfed',
                            400: '#33bfe7',
                            500: '#00a3d9',
                            600: '#0088b8',
                            700: '#006e96',
                            800: '#005577',
                            900: '#003d54',
                        }
                    }
                }
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        [x-cloak] { display: none !important; }
        .mermaid { background: #f1f5f9; border-radius: 8px; padding: 16px; }
        .dark .mermaid { background: #1e293b; }
        .mermaid svg { max-width: 100%; }
        details summary { cursor: pointer; }
        details summary::-webkit-details-marker { display: none; }
        .pk { color: #f59e0b; font-weight: 600; }
        .fk { color: #3b82f6; font-weight: 600; }
        /* Scrollbar (same as main layout) */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
        @media print {
            body { background: white !important; color: black !important; font-size: 10px; }
            nav, .no-print { display: none !important; }
            main { margin-left: 0 !important; }
            .mermaid { background: #f1f5f9 !important; }
            details { break-inside: avoid; }
            details[open] summary ~ * { display: block !important; }
            h2 { break-before: page; }
            .print-break { break-before: page; }
        }
    </style>
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script>
        // Initialize mermaid after Alpine sets dark mode
        document.addEventListener('alpine:init', () => {
            const isDark = localStorage.getItem('darkMode') === 'true';
            mermaid.initialize({
                startOnLoad: true,
                theme: isDark ? 'dark' : 'default',
                er: { useMaxWidth: true, layoutDirection: 'TB' }
            });
        });
    </script>
</head>
<body class="bg-slate-50 dark:bg-slate-900 text-slate-700 dark:text-slate-200 min-h-screen font-sans"
      x-data="{ darkMode: localStorage.getItem('darkMode') === 'true' }"
      x-init="$watch('darkMode', val => localStorage.setItem('darkMode', val))"
      :class="{ 'dark': darkMode }">

<!-- Navigation -->
<nav class="fixed top-0 left-0 w-64 h-full bg-white dark:bg-slate-800 border-r border-slate-200 dark:border-slate-700 overflow-y-auto z-50 no-print">
    <div class="flex h-16 shrink-0 items-center px-6 border-b border-slate-200 dark:border-slate-700">
        <img src="../public/assets/images/logo-ainstein-orizzontal.png" alt="Ainstein" class="h-8 dark:brightness-0 dark:invert">
    </div>
    <div class="p-4">
        <p class="px-3 mb-1 text-xs font-semibold uppercase tracking-wider text-slate-400 dark:text-slate-500">Data Model</p>
        <p class="px-3 mb-3 text-xs text-slate-400 dark:text-slate-500">~81 tabelle &middot; 8 moduli</p>
    </div>
    <div class="px-3 pb-3 space-y-1 text-sm">
        <a href="#overview" class="flex items-center gap-2 px-3 py-2 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700/50 font-medium transition-colors">
            <svg class="w-4 h-4 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
            Panoramica
        </a>
        <div class="pt-3 pb-1 px-3 text-xs font-semibold text-slate-400 dark:text-slate-500 uppercase tracking-wider">Core</div>
        <a href="#core" class="flex items-center gap-2 px-3 py-2 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700/50 transition-colors">
            <svg class="w-4 h-4 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"/></svg>
            Tabelle Core (17)
        </a>
        <div class="pt-3 pb-1 px-3 text-xs font-semibold text-slate-400 dark:text-slate-500 uppercase tracking-wider">Moduli</div>
        <a href="#aic" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700/50 text-amber-600 dark:text-amber-400 transition-colors">
            <span class="w-2 h-2 rounded-full bg-amber-500"></span>
            AI Content (aic_)
        </a>
        <a href="#sa" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700/50 text-emerald-600 dark:text-emerald-400 transition-colors">
            <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
            SEO Audit (sa_)
        </a>
        <a href="#st" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700/50 text-blue-600 dark:text-blue-400 transition-colors">
            <span class="w-2 h-2 rounded-full bg-blue-500"></span>
            SEO Tracking (st_)
        </a>
        <a href="#kr" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700/50 text-purple-600 dark:text-purple-400 transition-colors">
            <span class="w-2 h-2 rounded-full bg-purple-500"></span>
            Keyword Research (kr_)
        </a>
        <a href="#il" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700/50 text-cyan-600 dark:text-cyan-400 transition-colors">
            <span class="w-2 h-2 rounded-full bg-cyan-500"></span>
            Internal Links (il_)
        </a>
        <a href="#ga" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700/50 text-rose-600 dark:text-rose-400 transition-colors">
            <span class="w-2 h-2 rounded-full bg-rose-500"></span>
            Ads Analyzer (ga_)
        </a>
        <a href="#cc" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700/50 text-orange-600 dark:text-orange-400 transition-colors">
            <span class="w-2 h-2 rounded-full bg-orange-500"></span>
            Content Creator (cc_)
        </a>
    </div>
</nav>

<!-- Main Content -->
<main class="ml-64 p-8 max-w-6xl">

    <!-- Dark mode toggle (top-right) -->
    <div class="fixed top-4 right-4 z-50 no-print">
        <button @click="darkMode = !darkMode" class="p-2 rounded-lg text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 shadow-sm hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
            <svg x-show="!darkMode" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
            </svg>
            <svg x-show="darkMode" x-cloak class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
            </svg>
        </button>
    </div>

    <!-- Header -->
    <div class="mb-12">
        <h1 class="text-3xl font-bold text-slate-900 dark:text-white mb-2">Ainstein SEO Toolkit &mdash; Data Model</h1>
        <p class="text-slate-500 dark:text-slate-400">Documentazione completa dello schema database. Generato il <strong class="text-slate-700 dark:text-slate-300">24 Febbraio 2026</strong>.</p>
        <div class="flex flex-wrap gap-3 mt-4 text-sm">
            <span class="px-3 py-1 bg-white dark:bg-slate-800 rounded-full border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300">~81 tabelle</span>
            <span class="px-3 py-1 bg-white dark:bg-slate-800 rounded-full border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300">8 moduli</span>
            <span class="px-3 py-1 bg-white dark:bg-slate-800 rounded-full border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300">MySQL 8.0 / InnoDB</span>
            <span class="px-3 py-1 bg-white dark:bg-slate-800 rounded-full border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300">utf8mb4</span>
        </div>
        <div class="mt-4 flex gap-3 text-xs">
            <span class="pk">&#9679; PK = Primary Key</span>
            <span class="fk">&#9679; FK = Foreign Key</span>
            <span class="text-slate-400">&#9679; UK = Unique Key</span>
        </div>
    </div>

    <!-- ==================== OVERVIEW ==================== -->
    <section id="overview" class="mb-16">
        <h2 class="text-2xl font-bold text-slate-900 dark:text-white mb-6 flex items-center gap-2">
            <svg class="w-6 h-6 text-primary-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2 1 3 3 3h10c2 0 3-1 3-3V7c0-2-1-3-3-3H7c-2 0-3 1-3 3z"/></svg>
            Panoramica Generale
        </h2>
        <p class="text-slate-500 dark:text-slate-400 mb-6">Relazioni principali tra la tabella <code class="text-amber-400">users</code> e le tabelle progetto di ogni modulo.</p>
        <div class="mermaid">
erDiagram
    users ||--o{ projects : "possiede"
    projects ||--o{ aic_wp_sites : "connettori WP"
    projects ||--o{ aic_projects : "attiva"
    projects ||--o{ sa_projects : "attiva"
    projects ||--o{ st_projects : "attiva"
    projects ||--o{ kr_projects : "attiva"
    projects ||--o{ il_projects : "attiva"
    projects ||--o{ ga_projects : "attiva"
    projects ||--o{ project_members : "has members"
    projects ||--o{ project_invitations : "has invitations"
    users ||--o{ project_members : "is member of"
    users ||--o{ project_invitations : "invited by"
    project_members ||--o{ project_member_modules : "has module access"
    users ||--o{ notifications : "riceve"
    users ||--o{ notification_preferences : "configura"
    users ||--o{ email_unsubscribe_tokens : "unsubscribe"
    users ||--o{ aic_projects : "possiede"
    users ||--o{ sa_projects : "possiede"
    users ||--o{ st_projects : "possiede"
    users ||--o{ kr_projects : "possiede"
    users ||--o{ il_projects : "possiede"
    users ||--o{ ga_projects : "possiede"
    users ||--o{ credit_transactions : "genera"
    users ||--o{ usage_log : "registra"
    users ||--o{ subscriptions : "sottoscrive"
    subscriptions }o--|| plans : "piano"
    projects {
        int id PK
        int user_id FK
        varchar name
        varchar domain
        varchar color
        enum status
    }
    users {
        int id PK
        varchar email UK
        varchar name
        enum role "admin/user"
        decimal credits
    }
    plans {
        int id PK
        varchar slug UK
        int credits_monthly
        decimal price_monthly
    }
    project_members {
        int id PK
        int project_id FK
        int user_id FK
        enum role "editor, viewer"
        int invited_by FK
        timestamp accepted_at
    }
    project_member_modules {
        int id PK
        int member_id FK
        varchar module_slug
    }
    project_invitations {
        int id PK
        int project_id FK
        varchar email
        enum role "editor, viewer"
        json modules
        varchar token
        int invited_by FK
        timestamp expires_at
    }
    notifications {
        int id PK
        int user_id FK
        varchar type
        varchar title
        text body
        varchar icon
        varchar color
        varchar action_url
        json data
        timestamp read_at
        timestamp created_at
    }
    notification_preferences {
        int id PK
        int user_id FK
        varchar type UK
        tinyint email_enabled
        timestamp created_at
    }
    email_templates {
        int id PK
        varchar slug UK
        varchar name
        varchar category
        varchar subject
        longtext body_html
        json available_vars
        tinyint is_active
    }
    email_unsubscribe_tokens {
        int id PK
        int user_id FK
        varchar token UK
        timestamp created_at
    }
        </div>
    </section>

    <!-- ==================== CORE ==================== -->
    <section id="core" class="mb-16 print-break">
        <h2 class="text-2xl font-bold text-slate-900 dark:text-white mb-6">Tabelle Core</h2>
        <p class="text-slate-500 dark:text-slate-400 mb-6">Tabelle condivise dall'intero framework: autenticazione, crediti, piani, logging, notifiche, email.</p>

        <div class="mermaid">
erDiagram
    users ||--o{ credit_transactions : "movimenti"
    users ||--o{ usage_log : "utilizzo"
    users ||--o{ subscriptions : "abbonamenti"
    subscriptions }o--|| plans : "piano"
    users ||--o{ ai_logs : "log AI"
    settings ||--o{ users : "updated_by"
    users ||--o{ projects : "hub progetti"
    projects ||--o{ project_members : "has members"
    projects ||--o{ project_invitations : "has invitations"
    users ||--o{ project_members : "is member of"
    users ||--o{ project_invitations : "invited by"
    project_members ||--o{ project_member_modules : "has module access"
    users ||--o{ notifications : "riceve"
    users ||--o{ notification_preferences : "configura"
    users ||--o{ email_unsubscribe_tokens : "unsubscribe"
    projects {
        int id PK
        int user_id FK
        varchar name
        varchar domain
        text description
        varchar color
        enum status
        timestamp created_at
        timestamp updated_at
    }
    users {
        int id PK
        varchar email UK
        varchar password
        varchar name
        enum role
        decimal credits
        boolean is_active
    }
    credit_transactions {
        int id PK
        int user_id FK
        decimal amount
        enum type
        varchar description
        decimal balance_after
    }
    usage_log {
        int id PK
        int user_id FK
        varchar module_slug
        varchar action
        decimal credits_used
    }
    plans {
        int id PK
        varchar slug UK
        int credits_monthly
        decimal price_monthly
        decimal price_yearly
        json features
    }
    subscriptions {
        int id PK
        int user_id FK
        int plan_id FK
        enum status
        decimal credits_remaining
    }
    settings {
        int id PK
        varchar key_name UK
        text value
        boolean is_secret
    }
    modules {
        int id PK
        varchar slug UK
        varchar name
        boolean is_active
        json settings
    }
    ai_logs {
        int id PK
        int user_id FK
        varchar module_slug
        varchar provider
        varchar model
        int tokens_total
        decimal estimated_cost
    }
    project_members {
        int id PK
        int project_id FK
        int user_id FK
        enum role "editor, viewer"
        int invited_by FK
        timestamp accepted_at
        timestamp created_at
    }
    project_member_modules {
        int id PK
        int member_id FK
        varchar module_slug
        timestamp created_at
    }
    project_invitations {
        int id PK
        int project_id FK
        varchar email
        enum role "editor, viewer"
        json modules
        varchar token
        int invited_by FK
        timestamp accepted_at
        timestamp expires_at
        timestamp created_at
    }
    notifications {
        int id PK
        int user_id FK
        varchar type
        varchar title
        text body
        varchar icon
        varchar color
        varchar action_url
        json data
        timestamp read_at
        timestamp created_at
    }
    notification_preferences {
        int id PK
        int user_id FK
        varchar type UK
        tinyint email_enabled
        timestamp created_at
    }
    email_templates {
        int id PK
        varchar slug UK
        varchar name
        varchar category
        varchar subject
        longtext body_html
        json available_vars
        tinyint is_active
    }
    email_unsubscribe_tokens {
        int id PK
        int user_id FK
        varchar token UK
        timestamp created_at
    }
    %% project_connectors DROPPED - unificato in aic_wp_sites
        </div>

        <!-- users -->
        <details class="mt-6 bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white flex justify-between items-center">
                users
                <span class="text-xs text-slate-500 dark:text-slate-400">12 colonne</span>
            </summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 overflow-x-auto">
                <table class="w-full text-sm">
                    <thead><tr class="text-left text-slate-500 dark:text-slate-400 border-b border-slate-200 dark:border-slate-700"><th class="pb-2">Colonna</th><th class="pb-2">Tipo</th><th class="pb-2">Note</th></tr></thead>
                    <tbody class="text-slate-600 dark:text-slate-300">
                        <tr><td class="py-1 pk">id</td><td>INT AUTO_INCREMENT</td><td>PRIMARY KEY</td></tr>
                        <tr><td class="py-1">email</td><td>VARCHAR(255)</td><td>UNIQUE</td></tr>
                        <tr><td class="py-1">password</td><td>VARCHAR(255)</td><td></td></tr>
                        <tr><td class="py-1">name</td><td>VARCHAR(255)</td><td></td></tr>
                        <tr><td class="py-1">role</td><td>ENUM('admin','user')</td><td>DEFAULT 'user'</td></tr>
                        <tr><td class="py-1">credits</td><td>DECIMAL(10,2)</td><td>DEFAULT 30.00</td></tr>
                        <tr><td class="py-1">is_active</td><td>TINYINT(1)</td><td>DEFAULT 1</td></tr>
                        <tr><td class="py-1">remember_token</td><td>VARCHAR(255)</td><td></td></tr>
                        <tr><td class="py-1">created_at</td><td>TIMESTAMP</td><td></td></tr>
                        <tr><td class="py-1">updated_at</td><td>TIMESTAMP</td><td>ON UPDATE</td></tr>
                    </tbody>
                </table>
            </div>
        </details>

        <!-- credit_transactions -->
        <details class="mt-3 bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white flex justify-between items-center">
                credit_transactions
                <span class="text-xs text-slate-500 dark:text-slate-400">8 colonne</span>
            </summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 overflow-x-auto">
                <table class="w-full text-sm">
                    <thead><tr class="text-left text-slate-500 dark:text-slate-400 border-b border-slate-200 dark:border-slate-700"><th class="pb-2">Colonna</th><th class="pb-2">Tipo</th><th class="pb-2">Note</th></tr></thead>
                    <tbody class="text-slate-600 dark:text-slate-300">
                        <tr><td class="py-1 pk">id</td><td>INT AUTO_INCREMENT</td><td>PRIMARY KEY</td></tr>
                        <tr><td class="py-1 fk">user_id</td><td>INT</td><td>FK &rarr; users(id) CASCADE</td></tr>
                        <tr><td class="py-1">amount</td><td>DECIMAL(10,2)</td><td></td></tr>
                        <tr><td class="py-1">type</td><td>ENUM('purchase','subscription','manual','usage','bonus')</td><td></td></tr>
                        <tr><td class="py-1">description</td><td>VARCHAR(255)</td><td></td></tr>
                        <tr><td class="py-1 fk">admin_id</td><td>INT</td><td>FK &rarr; users(id) SET NULL</td></tr>
                        <tr><td class="py-1">balance_after</td><td>DECIMAL(10,2)</td><td></td></tr>
                        <tr><td class="py-1">created_at</td><td>TIMESTAMP</td><td></td></tr>
                    </tbody>
                </table>
            </div>
        </details>

        <!-- usage_log -->
        <details class="mt-3 bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white flex justify-between items-center">
                usage_log
                <span class="text-xs text-slate-500 dark:text-slate-400">6 colonne</span>
            </summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 overflow-x-auto">
                <table class="w-full text-sm">
                    <thead><tr class="text-left text-slate-500 dark:text-slate-400 border-b border-slate-200 dark:border-slate-700"><th class="pb-2">Colonna</th><th class="pb-2">Tipo</th><th class="pb-2">Note</th></tr></thead>
                    <tbody class="text-slate-600 dark:text-slate-300">
                        <tr><td class="py-1 pk">id</td><td>INT AUTO_INCREMENT</td><td>PRIMARY KEY</td></tr>
                        <tr><td class="py-1 fk">user_id</td><td>INT</td><td>FK &rarr; users(id) CASCADE</td></tr>
                        <tr><td class="py-1">module_slug</td><td>VARCHAR(100)</td><td></td></tr>
                        <tr><td class="py-1">action</td><td>VARCHAR(100)</td><td></td></tr>
                        <tr><td class="py-1">credits_used</td><td>DECIMAL(5,2)</td><td></td></tr>
                        <tr><td class="py-1">metadata</td><td>JSON</td><td></td></tr>
                        <tr><td class="py-1">created_at</td><td>TIMESTAMP</td><td></td></tr>
                    </tbody>
                </table>
            </div>
        </details>

        <!-- plans, subscriptions, settings, modules, ai_logs, password_resets -->
        <details class="mt-3 bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white flex justify-between items-center">
                plans
                <span class="text-xs text-slate-500 dark:text-slate-400">9 colonne</span>
            </summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 overflow-x-auto">
                <table class="w-full text-sm">
                    <thead><tr class="text-left text-slate-500 dark:text-slate-400 border-b border-slate-200 dark:border-slate-700"><th class="pb-2">Colonna</th><th class="pb-2">Tipo</th><th class="pb-2">Note</th></tr></thead>
                    <tbody class="text-slate-600 dark:text-slate-300">
                        <tr><td class="py-1 pk">id</td><td>INT AUTO_INCREMENT</td><td>PRIMARY KEY</td></tr>
                        <tr><td class="py-1">name</td><td>VARCHAR(100)</td><td></td></tr>
                        <tr><td class="py-1">slug</td><td>VARCHAR(100)</td><td>UNIQUE</td></tr>
                        <tr><td class="py-1">credits_monthly</td><td>INT</td><td></td></tr>
                        <tr><td class="py-1">price_monthly</td><td>DECIMAL(10,2)</td><td></td></tr>
                        <tr><td class="py-1">price_yearly</td><td>DECIMAL(10,2)</td><td></td></tr>
                        <tr><td class="py-1">is_active</td><td>TINYINT(1)</td><td>DEFAULT 1</td></tr>
                        <tr><td class="py-1">features</td><td>JSON</td><td></td></tr>
                        <tr><td class="py-1">created_at</td><td>TIMESTAMP</td><td></td></tr>
                    </tbody>
                </table>
            </div>
        </details>

        <details class="mt-3 bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white flex justify-between items-center">
                subscriptions
                <span class="text-xs text-slate-500 dark:text-slate-400">8 colonne</span>
            </summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 overflow-x-auto">
                <table class="w-full text-sm">
                    <thead><tr class="text-left text-slate-500 dark:text-slate-400 border-b border-slate-200 dark:border-slate-700"><th class="pb-2">Colonna</th><th class="pb-2">Tipo</th><th class="pb-2">Note</th></tr></thead>
                    <tbody class="text-slate-600 dark:text-slate-300">
                        <tr><td class="py-1 pk">id</td><td>INT AUTO_INCREMENT</td><td>PRIMARY KEY</td></tr>
                        <tr><td class="py-1 fk">user_id</td><td>INT</td><td>FK &rarr; users(id) CASCADE</td></tr>
                        <tr><td class="py-1 fk">plan_id</td><td>INT</td><td>FK &rarr; plans(id) CASCADE</td></tr>
                        <tr><td class="py-1">status</td><td>ENUM('active','cancelled','expired')</td><td></td></tr>
                        <tr><td class="py-1">credits_remaining</td><td>DECIMAL(10,2)</td><td></td></tr>
                        <tr><td class="py-1">current_period_start</td><td>DATE</td><td></td></tr>
                        <tr><td class="py-1">current_period_end</td><td>DATE</td><td></td></tr>
                        <tr><td class="py-1">stripe_subscription_id</td><td>VARCHAR(255)</td><td></td></tr>
                    </tbody>
                </table>
            </div>
        </details>

        <details class="mt-3 bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white flex justify-between items-center">
                settings &middot; modules &middot; ai_logs &middot; password_resets
                <span class="text-xs text-slate-500 dark:text-slate-400">Altre tabelle core</span>
            </summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 space-y-4 text-sm text-slate-600 dark:text-slate-300">
                <div><strong class="text-slate-900 dark:text-white">settings</strong>: id(PK), key_name(UK), value, is_secret, updated_by(FK&rarr;users), updated_at</div>
                <div><strong class="text-slate-900 dark:text-white">modules</strong>: id(PK), slug(UK), name, description, version, is_active, settings(JSON), created_at, updated_at</div>
                <div><strong class="text-slate-900 dark:text-white">ai_logs</strong>: id(PK), user_id(FK), module_slug, provider, model, request_payload, response_payload, tokens_input, tokens_output, tokens_total(GENERATED), duration_ms, status, error_message, fallback_from, estimated_cost, credits_used, created_at</div>
                <div><strong class="text-slate-900 dark:text-white">password_resets</strong>: id(PK), email, token, created_at</div>
            </div>
        </details>

        <details class="mb-4 border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden">
            <summary class="bg-slate-50 dark:bg-slate-800 px-4 py-3 cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700 font-medium text-slate-900 dark:text-white">
                projects (Hub Progetti Globali)
            </summary>
            <div class="p-4 overflow-x-auto">
                <table class="w-full text-sm">
                    <thead><tr class="border-b border-slate-200 dark:border-slate-700">
                        <th class="text-left py-2 px-3 text-slate-500 dark:text-slate-400">Colonna</th>
                        <th class="text-left py-2 px-3 text-slate-500 dark:text-slate-400">Tipo</th>
                        <th class="text-left py-2 px-3 text-slate-500 dark:text-slate-400">Note</th>
                    </tr></thead>
                    <tbody class="text-slate-700 dark:text-slate-300">
                        <tr><td class="py-1.5 px-3 font-mono text-xs">id</td><td class="py-1.5 px-3">INT AUTO_INCREMENT</td><td class="py-1.5 px-3"><span class="text-amber-500 font-semibold">PK</span></td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">user_id</td><td class="py-1.5 px-3">INT</td><td class="py-1.5 px-3"><span class="text-blue-500 font-semibold">FK</span> &rarr; users.id</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">name</td><td class="py-1.5 px-3">VARCHAR(255)</td><td class="py-1.5 px-3">Nome progetto</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">domain</td><td class="py-1.5 px-3">VARCHAR(500)</td><td class="py-1.5 px-3">Dominio sito (nullable)</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">description</td><td class="py-1.5 px-3">TEXT</td><td class="py-1.5 px-3">Descrizione (nullable)</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">color</td><td class="py-1.5 px-3">VARCHAR(7)</td><td class="py-1.5 px-3">Colore hex (#3B82F6)</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">status</td><td class="py-1.5 px-3">ENUM('active','archived')</td><td class="py-1.5 px-3">Default: active</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">created_at</td><td class="py-1.5 px-3">TIMESTAMP</td><td class="py-1.5 px-3">DEFAULT CURRENT_TIMESTAMP</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">updated_at</td><td class="py-1.5 px-3">TIMESTAMP</td><td class="py-1.5 px-3">ON UPDATE CURRENT_TIMESTAMP</td></tr>
                    </tbody>
                </table>
            </div>
        </details>

        <!-- project_connectors DROPPED - unificato in aic_wp_sites (commit 8f96346) -->

        <!-- project_members -->
        <details class="mb-4 border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden">
            <summary class="bg-slate-50 dark:bg-slate-800 px-4 py-3 cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700 font-medium text-slate-900 dark:text-white">
                project_members (Condivisione Progetti)
            </summary>
            <div class="p-4 overflow-x-auto">
                <table class="w-full text-sm">
                    <thead><tr class="border-b border-slate-200 dark:border-slate-700">
                        <th class="text-left py-2 px-3 text-slate-500 dark:text-slate-400">Colonna</th>
                        <th class="text-left py-2 px-3 text-slate-500 dark:text-slate-400">Tipo</th>
                        <th class="text-left py-2 px-3 text-slate-500 dark:text-slate-400">Note</th>
                    </tr></thead>
                    <tbody class="text-slate-700 dark:text-slate-300">
                        <tr><td class="py-1.5 px-3 font-mono text-xs">id</td><td class="py-1.5 px-3">INT AUTO_INCREMENT</td><td class="py-1.5 px-3"><span class="text-amber-500 font-semibold">PK</span></td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">project_id</td><td class="py-1.5 px-3">INT</td><td class="py-1.5 px-3"><span class="text-blue-500 font-semibold">FK</span> &rarr; projects.id CASCADE</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">user_id</td><td class="py-1.5 px-3">INT</td><td class="py-1.5 px-3"><span class="text-blue-500 font-semibold">FK</span> &rarr; users.id CASCADE</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">role</td><td class="py-1.5 px-3">ENUM('editor','viewer')</td><td class="py-1.5 px-3">Ruolo del membro nel progetto</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">invited_by</td><td class="py-1.5 px-3">INT</td><td class="py-1.5 px-3"><span class="text-blue-500 font-semibold">FK</span> &rarr; users.id SET NULL</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">accepted_at</td><td class="py-1.5 px-3">TIMESTAMP</td><td class="py-1.5 px-3">NULL = invito in attesa</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">created_at</td><td class="py-1.5 px-3">TIMESTAMP</td><td class="py-1.5 px-3">DEFAULT CURRENT_TIMESTAMP</td></tr>
                    </tbody>
                </table>
                <p class="mt-3 text-xs text-slate-500 dark:text-slate-400">UNIQUE(project_id, user_id) &mdash; Un utente puo essere membro di un progetto una sola volta.</p>
            </div>
        </details>

        <!-- project_member_modules -->
        <details class="mb-4 border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden">
            <summary class="bg-slate-50 dark:bg-slate-800 px-4 py-3 cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700 font-medium text-slate-900 dark:text-white">
                project_member_modules (Accesso Moduli per Membro)
            </summary>
            <div class="p-4 overflow-x-auto">
                <table class="w-full text-sm">
                    <thead><tr class="border-b border-slate-200 dark:border-slate-700">
                        <th class="text-left py-2 px-3 text-slate-500 dark:text-slate-400">Colonna</th>
                        <th class="text-left py-2 px-3 text-slate-500 dark:text-slate-400">Tipo</th>
                        <th class="text-left py-2 px-3 text-slate-500 dark:text-slate-400">Note</th>
                    </tr></thead>
                    <tbody class="text-slate-700 dark:text-slate-300">
                        <tr><td class="py-1.5 px-3 font-mono text-xs">id</td><td class="py-1.5 px-3">INT AUTO_INCREMENT</td><td class="py-1.5 px-3"><span class="text-amber-500 font-semibold">PK</span></td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">member_id</td><td class="py-1.5 px-3">INT</td><td class="py-1.5 px-3"><span class="text-blue-500 font-semibold">FK</span> &rarr; project_members.id CASCADE</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">module_slug</td><td class="py-1.5 px-3">VARCHAR(100)</td><td class="py-1.5 px-3">Slug del modulo (es. seo-audit, ai-content)</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">created_at</td><td class="py-1.5 px-3">TIMESTAMP</td><td class="py-1.5 px-3">DEFAULT CURRENT_TIMESTAMP</td></tr>
                    </tbody>
                </table>
                <p class="mt-3 text-xs text-slate-500 dark:text-slate-400">UNIQUE(member_id, module_slug) &mdash; Il proprietario sceglie quali moduli condividere con ogni membro.</p>
            </div>
        </details>

        <!-- project_invitations -->
        <details class="mb-4 border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden">
            <summary class="bg-slate-50 dark:bg-slate-800 px-4 py-3 cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700 font-medium text-slate-900 dark:text-white">
                project_invitations (Inviti Progetto)
            </summary>
            <div class="p-4 overflow-x-auto">
                <table class="w-full text-sm">
                    <thead><tr class="border-b border-slate-200 dark:border-slate-700">
                        <th class="text-left py-2 px-3 text-slate-500 dark:text-slate-400">Colonna</th>
                        <th class="text-left py-2 px-3 text-slate-500 dark:text-slate-400">Tipo</th>
                        <th class="text-left py-2 px-3 text-slate-500 dark:text-slate-400">Note</th>
                    </tr></thead>
                    <tbody class="text-slate-700 dark:text-slate-300">
                        <tr><td class="py-1.5 px-3 font-mono text-xs">id</td><td class="py-1.5 px-3">INT AUTO_INCREMENT</td><td class="py-1.5 px-3"><span class="text-amber-500 font-semibold">PK</span></td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">project_id</td><td class="py-1.5 px-3">INT</td><td class="py-1.5 px-3"><span class="text-blue-500 font-semibold">FK</span> &rarr; projects.id CASCADE</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">email</td><td class="py-1.5 px-3">VARCHAR(255)</td><td class="py-1.5 px-3">Email del destinatario</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">role</td><td class="py-1.5 px-3">ENUM('editor','viewer')</td><td class="py-1.5 px-3">Ruolo assegnato all'invitato</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">modules</td><td class="py-1.5 px-3">JSON</td><td class="py-1.5 px-3">Array di module_slug accessibili</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">token</td><td class="py-1.5 px-3">VARCHAR(255)</td><td class="py-1.5 px-3">UNIQUE &mdash; Token per accettazione via link</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">invited_by</td><td class="py-1.5 px-3">INT</td><td class="py-1.5 px-3"><span class="text-blue-500 font-semibold">FK</span> &rarr; users.id SET NULL</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">accepted_at</td><td class="py-1.5 px-3">TIMESTAMP</td><td class="py-1.5 px-3">NULL = in attesa, valorizzato = accettato</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">expires_at</td><td class="py-1.5 px-3">TIMESTAMP</td><td class="py-1.5 px-3">Scadenza invito (7 giorni default)</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">created_at</td><td class="py-1.5 px-3">TIMESTAMP</td><td class="py-1.5 px-3">DEFAULT CURRENT_TIMESTAMP</td></tr>
                    </tbody>
                </table>
                <p class="mt-3 text-xs text-slate-500 dark:text-slate-400">Se l'utente invitato e gia registrato, riceve notifica interna. Se non registrato, riceve email con link di invito.</p>
            </div>
        </details>

        <!-- notifications -->
        <details class="mb-4 border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden">
            <summary class="bg-slate-50 dark:bg-slate-800 px-4 py-3 cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700 font-medium text-slate-900 dark:text-white">
                notifications (Notifiche In-App)
            </summary>
            <div class="p-4 overflow-x-auto">
                <table class="w-full text-sm">
                    <thead><tr class="border-b border-slate-200 dark:border-slate-700">
                        <th class="text-left py-2 px-3 text-slate-500 dark:text-slate-400">Colonna</th>
                        <th class="text-left py-2 px-3 text-slate-500 dark:text-slate-400">Tipo</th>
                        <th class="text-left py-2 px-3 text-slate-500 dark:text-slate-400">Note</th>
                    </tr></thead>
                    <tbody class="text-slate-700 dark:text-slate-300">
                        <tr><td class="py-1.5 px-3 font-mono text-xs">id</td><td class="py-1.5 px-3">INT AUTO_INCREMENT</td><td class="py-1.5 px-3"><span class="text-amber-500 font-semibold">PK</span></td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">user_id</td><td class="py-1.5 px-3">INT</td><td class="py-1.5 px-3"><span class="text-blue-500 font-semibold">FK</span> &rarr; users.id CASCADE</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">type</td><td class="py-1.5 px-3">VARCHAR(50)</td><td class="py-1.5 px-3">project_invite, operation_completed, operation_failed, ecc.</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">title</td><td class="py-1.5 px-3">VARCHAR(255)</td><td class="py-1.5 px-3">Titolo visibile nella notifica</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">body</td><td class="py-1.5 px-3">TEXT</td><td class="py-1.5 px-3">NULL &mdash; Corpo opzionale della notifica</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">icon</td><td class="py-1.5 px-3">VARCHAR(50)</td><td class="py-1.5 px-3">NULL &mdash; Nome icona Heroicons (es. user-plus, check-circle)</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">color</td><td class="py-1.5 px-3">VARCHAR(20)</td><td class="py-1.5 px-3">NULL &mdash; Colore Tailwind (blue, emerald, red, ecc.)</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">action_url</td><td class="py-1.5 px-3">VARCHAR(500)</td><td class="py-1.5 px-3">NULL &mdash; URL di destinazione al click</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">data</td><td class="py-1.5 px-3">JSON</td><td class="py-1.5 px-3">NULL &mdash; Dati extra strutturati</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">read_at</td><td class="py-1.5 px-3">TIMESTAMP</td><td class="py-1.5 px-3">NULL = non letta, valorizzato = letta</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">created_at</td><td class="py-1.5 px-3">TIMESTAMP</td><td class="py-1.5 px-3">DEFAULT CURRENT_TIMESTAMP</td></tr>
                    </tbody>
                </table>
                <p class="mt-3 text-xs text-slate-500 dark:text-slate-400">Polling: /notifications/unread-count ogni 30s. Cleanup: cron cancella notifiche lette &gt;30 giorni e non lette &gt;90 giorni.</p>
            </div>
        </details>

        <!-- notification_preferences -->
        <details class="mb-4 border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden">
            <summary class="bg-slate-50 dark:bg-slate-800 px-4 py-3 cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700 font-medium text-slate-900 dark:text-white">
                notification_preferences (Preferenze Notifiche Email)
            </summary>
            <div class="p-4 overflow-x-auto">
                <table class="w-full text-sm">
                    <thead><tr class="border-b border-slate-200 dark:border-slate-700">
                        <th class="text-left py-2 px-3 text-slate-500 dark:text-slate-400">Colonna</th>
                        <th class="text-left py-2 px-3 text-slate-500 dark:text-slate-400">Tipo</th>
                        <th class="text-left py-2 px-3 text-slate-500 dark:text-slate-400">Note</th>
                    </tr></thead>
                    <tbody class="text-slate-700 dark:text-slate-300">
                        <tr><td class="py-1.5 px-3 font-mono text-xs">id</td><td class="py-1.5 px-3">INT AUTO_INCREMENT</td><td class="py-1.5 px-3"><span class="text-amber-500 font-semibold">PK</span></td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">user_id</td><td class="py-1.5 px-3">INT</td><td class="py-1.5 px-3"><span class="text-blue-500 font-semibold">FK</span> &rarr; users.id CASCADE</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">type</td><td class="py-1.5 px-3">VARCHAR(50)</td><td class="py-1.5 px-3">Tipo notifica (corrisponde a notifications.type)</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">email_enabled</td><td class="py-1.5 px-3">TINYINT(1)</td><td class="py-1.5 px-3">DEFAULT 1 &mdash; Se inviare email per questo tipo</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">created_at</td><td class="py-1.5 px-3">TIMESTAMP</td><td class="py-1.5 px-3">DEFAULT CURRENT_TIMESTAMP</td></tr>
                    </tbody>
                </table>
                <p class="mt-3 text-xs text-slate-500 dark:text-slate-400">UNIQUE(user_id, type). Gestite dalla pagina /profile. Default: tutte le email abilitate.</p>
            </div>
        </details>

        <!-- email_templates -->
        <details class="mb-4 border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden">
            <summary class="bg-slate-50 dark:bg-slate-800 px-4 py-3 cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700 font-medium text-slate-900 dark:text-white">
                email_templates (Template Email Admin-Customizzabili)
            </summary>
            <div class="p-4 overflow-x-auto">
                <table class="w-full text-sm">
                    <thead><tr class="border-b border-slate-200 dark:border-slate-700">
                        <th class="text-left py-2 px-3 text-slate-500 dark:text-slate-400">Colonna</th>
                        <th class="text-left py-2 px-3 text-slate-500 dark:text-slate-400">Tipo</th>
                        <th class="text-left py-2 px-3 text-slate-500 dark:text-slate-400">Note</th>
                    </tr></thead>
                    <tbody class="text-slate-700 dark:text-slate-300">
                        <tr><td class="py-1.5 px-3 font-mono text-xs">id</td><td class="py-1.5 px-3">INT AUTO_INCREMENT</td><td class="py-1.5 px-3"><span class="text-amber-500 font-semibold">PK</span></td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">slug</td><td class="py-1.5 px-3">VARCHAR(100)</td><td class="py-1.5 px-3">UNIQUE &mdash; Identificatore template (welcome, password-reset, ecc.)</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">name</td><td class="py-1.5 px-3">VARCHAR(255)</td><td class="py-1.5 px-3">Nome visualizzato nell'admin</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">category</td><td class="py-1.5 px-3">VARCHAR(50)</td><td class="py-1.5 px-3">DEFAULT 'system' &mdash; Valori: auth, notification, module, report</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">subject</td><td class="py-1.5 px-3">VARCHAR(255)</td><td class="py-1.5 px-3">Oggetto email con {{placeholder}}</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">body_html</td><td class="py-1.5 px-3">LONGTEXT</td><td class="py-1.5 px-3">Body HTML con {{placeholder}} &mdash; renderizzato dentro base.php</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">description</td><td class="py-1.5 px-3">TEXT NULL</td><td class="py-1.5 px-3">Descrizione per l'admin (quando viene inviata)</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">available_vars</td><td class="py-1.5 px-3">JSON</td><td class="py-1.5 px-3">Elenco variabili disponibili per il template (es. user_name, app_url)</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">is_active</td><td class="py-1.5 px-3">TINYINT(1)</td><td class="py-1.5 px-3">DEFAULT 1 &mdash; Se disattivo, l'email non viene inviata</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">created_at</td><td class="py-1.5 px-3">TIMESTAMP</td><td class="py-1.5 px-3">DEFAULT CURRENT_TIMESTAMP</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">updated_at</td><td class="py-1.5 px-3">TIMESTAMP</td><td class="py-1.5 px-3">ON UPDATE CURRENT_TIMESTAMP</td></tr>
                    </tbody>
                </table>
                <p class="mt-3 text-xs text-slate-500 dark:text-slate-400">8 template seed: welcome, password-reset, password-changed, email-changed, project-invite, notification, seo-alert, admin-report. Admin pu&ograve; editare subject e body_html via /admin/email-templates.</p>
            </div>
        </details>

        <!-- email_unsubscribe_tokens -->
        <details class="mb-4 border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden">
            <summary class="bg-slate-50 dark:bg-slate-800 px-4 py-3 cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700 font-medium text-slate-900 dark:text-white">
                email_unsubscribe_tokens (Token Disiscrizione Email)
            </summary>
            <div class="p-4 overflow-x-auto">
                <table class="w-full text-sm">
                    <thead><tr class="border-b border-slate-200 dark:border-slate-700">
                        <th class="text-left py-2 px-3 text-slate-500 dark:text-slate-400">Colonna</th>
                        <th class="text-left py-2 px-3 text-slate-500 dark:text-slate-400">Tipo</th>
                        <th class="text-left py-2 px-3 text-slate-500 dark:text-slate-400">Note</th>
                    </tr></thead>
                    <tbody class="text-slate-700 dark:text-slate-300">
                        <tr><td class="py-1.5 px-3 font-mono text-xs">id</td><td class="py-1.5 px-3">INT AUTO_INCREMENT</td><td class="py-1.5 px-3"><span class="text-amber-500 font-semibold">PK</span></td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">user_id</td><td class="py-1.5 px-3">INT</td><td class="py-1.5 px-3"><span class="text-blue-500 font-semibold">FK</span> &rarr; users.id CASCADE</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">token</td><td class="py-1.5 px-3">VARCHAR(64)</td><td class="py-1.5 px-3">UNIQUE &mdash; Token per link disiscrizione nelle email</td></tr>
                        <tr><td class="py-1.5 px-3 font-mono text-xs">created_at</td><td class="py-1.5 px-3">TIMESTAMP</td><td class="py-1.5 px-3">DEFAULT CURRENT_TIMESTAMP</td></tr>
                    </tbody>
                </table>
                <p class="mt-3 text-xs text-slate-500 dark:text-slate-400">Un token per utente. Generato al primo invio email. Consente accesso alla pagina /email/preferences senza login. Pulizia token orfani nel cron giornaliero.</p>
            </div>
        </details>

    </section>

    <!-- ==================== AI CONTENT ==================== -->
    <section id="aic" class="mb-16 print-break">
        <h2 class="text-2xl font-bold text-amber-400 mb-6">AI Content Generator (aic_)</h2>
        <p class="text-slate-500 dark:text-slate-400 mb-6">11 tabelle. Generazione articoli SEO con SERP analysis, brief AI e WordPress integration.</p>

        <div class="mermaid">
erDiagram
    aic_projects ||--o{ aic_keywords : "contiene"
    aic_projects ||--o{ aic_meta_tags : "meta tags"
    aic_projects ||--o{ aic_internal_links_pool : "link pool"
    aic_projects ||--o{ aic_process_jobs : "jobs"
    aic_keywords ||--o{ aic_serp_results : "SERP"
    aic_keywords ||--o{ aic_paa_questions : "PAA"
    aic_keywords ||--o{ aic_articles : "articolo"
    aic_articles ||--o{ aic_sources : "fonti"
    aic_articles ||--o{ aic_wp_publish_log : "pubblicazione"
    aic_wp_sites ||--o{ aic_wp_publish_log : "sito WP"
    aic_projects {
        int id PK
        int user_id FK
        varchar name
        json settings
    }
    aic_keywords {
        int id PK
        int project_id FK
        varchar keyword
        varchar language
    }
    aic_articles {
        int id PK
        int keyword_id FK
        varchar title
        longtext content
        enum status
        int credits_used
    }
    aic_meta_tags {
        int id PK
        int project_id FK
        varchar url
        varchar generated_title
        varchar generated_desc
        enum status
    }
        </div>

        <details class="mt-6 bg-white dark:bg-slate-800 rounded-lg border border-amber-200 dark:border-amber-900/50 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white">aic_projects</summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-600 dark:text-slate-300">
                id(PK), user_id(FK&rarr;users), name, description, default_language, default_location, settings(JSON), created_at, updated_at
            </div>
        </details>
        <details class="mt-2 bg-white dark:bg-slate-800 rounded-lg border border-amber-200 dark:border-amber-900/50 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white">aic_keywords</summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-600 dark:text-slate-300">
                id(PK), user_id(FK&rarr;users), project_id(FK&rarr;aic_projects), keyword, language, location, serp_extracted_at, created_at
            </div>
        </details>
        <details class="mt-2 bg-white dark:bg-slate-800 rounded-lg border border-amber-200 dark:border-amber-900/50 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white">aic_articles</summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-600 dark:text-slate-300">
                id(PK), user_id(FK&rarr;users), project_id, keyword_id(FK&rarr;aic_keywords), title, content(LONGTEXT), meta_description, word_count, status(draft/generating/ready/published/failed), brief_data(JSON), ai_model, generation_time_ms, credits_used, published_at, wp_site_id(FK&rarr;aic_wp_sites), wp_post_id, published_url, created_at, updated_at
            </div>
        </details>
        <details class="mt-2 bg-white dark:bg-slate-800 rounded-lg border border-amber-200 dark:border-amber-900/50 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white">aic_serp_results</summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-600 dark:text-slate-300">
                id(PK), keyword_id(FK&rarr;aic_keywords CASCADE), position, title, url, snippet, domain, created_at
            </div>
        </details>
        <details class="mt-2 bg-white dark:bg-slate-800 rounded-lg border border-amber-200 dark:border-amber-900/50 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white">aic_paa_questions</summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-600 dark:text-slate-300">
                id(PK), keyword_id(FK&rarr;aic_keywords CASCADE), question, snippet, position, created_at
            </div>
        </details>
        <details class="mt-2 bg-white dark:bg-slate-800 rounded-lg border border-amber-200 dark:border-amber-900/50 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white">aic_sources</summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-600 dark:text-slate-300">
                id(PK), article_id(FK&rarr;aic_articles CASCADE), url, title, content_extracted(LONGTEXT), headings_json(JSON), word_count, is_custom, scrape_status(pending/success/failed), error_message, scraped_at, created_at
            </div>
        </details>
        <details class="mt-2 bg-white dark:bg-slate-800 rounded-lg border border-amber-200 dark:border-amber-900/50 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white">aic_wp_sites &middot; aic_wp_publish_log &middot; aic_meta_tags &middot; aic_internal_links_pool &middot; aic_process_jobs</summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-600 dark:text-slate-300 space-y-3">
                <div><strong class="text-slate-900 dark:text-white">aic_wp_sites</strong>: id(PK), user_id(FK), global_project_id(FK&rarr;projects, nullable), name, url, api_key, is_active, last_sync_at, categories_cache(JSON) &mdash; <em>Single source of truth per connettori WordPress (unificato con project_connectors)</em></div>
                <div><strong class="text-slate-900 dark:text-white">aic_wp_publish_log</strong>: id(PK), article_id(FK), wp_site_id(FK), wp_post_id, status(success/failed), response_data(JSON)</div>
                <div><strong class="text-slate-900 dark:text-white">aic_meta_tags</strong>: id(PK), project_id(FK), user_id, url(UK con project), original_title, original_h1, current_meta_title/desc, generated_title/desc, scraped_content, status(pending/scraped/generated/approved/published/error), wp_site_id, wp_post_id, wp_post_type, scrape/generation/publish_error, timestamps</div>
                <div><strong class="text-slate-900 dark:text-white">aic_internal_links_pool</strong>: id(PK), project_id(FK), url(UK con project), title, description, sitemap_source, scrape_status, is_active</div>
                <div><strong class="text-slate-900 dark:text-white">aic_process_jobs</strong>: id(PK), project_id(FK), user_id(FK), type(cron/manual), status(pending/running/completed/error/cancelled), keywords_requested/completed/failed, current_queue_id, current_keyword, current_step, articles_generated, credits_used, error_message, started/completed_at</div>
            </div>
        </details>
    </section>

    <!-- ==================== SEO AUDIT ==================== -->
    <section id="sa" class="mb-16 print-break">
        <h2 class="text-2xl font-bold text-emerald-400 mb-6">SEO Audit (sa_)</h2>
        <p class="text-slate-500 dark:text-slate-400 mb-6">9 tabelle. Crawling sito e import WordPress, rilevamento 50+ problemi, Piano d'Azione AI con fix per pagina.</p>

        <div class="mermaid">
erDiagram
    sa_projects ||--o{ sa_pages : "pagine"
    sa_projects ||--o{ sa_issues : "problemi"
    sa_projects ||--|| sa_site_config : "config"
    sa_projects ||--o{ sa_action_plans : "piani azione"
    sa_projects ||--o{ sa_crawl_jobs : "ha"
    sa_action_plans ||--o{ sa_page_fixes : "fix pagina"
    sa_pages ||--o{ sa_issues : "problemi pagina"
    sa_crawl_sessions ||--o{ sa_crawl_jobs : "associata"
    sa_projects {
        int id PK
        int user_id FK
        varchar name
        varchar base_url
        int health_score
        enum status
    }
    sa_pages {
        int id PK
        int project_id FK
        varchar url
        int status_code
        varchar title
        int word_count
        enum source "scraper/wordpress"
    }
    sa_issues {
        int id PK
        int project_id FK
        int page_id FK
        varchar category
        enum severity
        varchar title
    }
    sa_crawl_jobs {
        int id PK
        int project_id FK
        int session_id FK
        int user_id
        enum type "crawl/wordpress"
        enum status "pending/running/completed/error/cancelled"
        json config
        int items_total
        int items_completed
        int items_failed
    }
        </div>

        <details class="mt-6 bg-white dark:bg-slate-800 rounded-lg border border-emerald-200 dark:border-emerald-900/50 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white">sa_projects</summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-600 dark:text-slate-300">
                id(PK), user_id(FK&rarr;users), name, base_url, crawl_mode(sitemap/spider/both), max_pages, status(pending/crawling/analyzing/completed/failed), pages_found, pages_crawled, issues_count, health_score, created_at, updated_at, completed_at
            </div>
        </details>
        <details class="mt-2 bg-white dark:bg-slate-800 rounded-lg border border-emerald-200 dark:border-emerald-900/50 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white">sa_pages <span class="text-xs text-slate-400 ml-2">~30 colonne</span></summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-600 dark:text-slate-300">
                id(PK), project_id(FK), url, status_code, load_time_ms, content_length, title, title_length, meta_description, meta_description_length, meta_robots, canonical_url, og_title/description/image, h1_count..h6_count, word_count, images_count, images_without_alt, images_data(JSON), internal/external/broken/nofollow_links_count, links_data(JSON), has_schema, schema_types(JSON), hreflang_tags(JSON), is_indexable, indexability_reason, html_content(LONGTEXT), crawled_at
            </div>
        </details>
        <details class="mt-2 bg-white dark:bg-slate-800 rounded-lg border border-emerald-200 dark:border-emerald-900/50 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white">sa_issues</summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-600 dark:text-slate-300">
                id(PK), project_id(FK), page_id(FK&rarr;sa_pages CASCADE), category, issue_type, severity(critical/warning/notice/info), title, description, affected_element, recommendation, source(crawler), created_at
            </div>
        </details>
        <details class="mt-2 bg-white dark:bg-slate-800 rounded-lg border border-emerald-200 dark:border-emerald-900/50 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white">sa_action_plans &middot; sa_page_fixes</summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-600 dark:text-slate-300 space-y-3">
                <div><strong class="text-slate-900 dark:text-white">sa_action_plans</strong>: id(PK), project_id(FK), session_id, total_pages, total_fixes, fixes_completed, health_current, health_expected, estimated_time_minutes, status(generating/ready/in_progress/completed), created_at, updated_at</div>
                <div><strong class="text-slate-900 dark:text-white">sa_page_fixes</strong>: id(PK), plan_id(FK&rarr;sa_action_plans), project_id(FK), page_id(FK&rarr;sa_pages), issue_id(FK&rarr;sa_issues), fix_code(TEXT), fix_explanation(TEXT), priority, difficulty(facile/medio/difficile), time_estimate_minutes, impact_points, step_order, is_completed, completed_at</div>
            </div>
        </details>
        <details class="mt-2 bg-white dark:bg-slate-800 rounded-lg border border-emerald-200 dark:border-emerald-900/50 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white">sa_crawl_jobs</summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 overflow-x-auto">
                <table class="w-full text-sm">
                    <thead><tr class="text-left text-slate-500 dark:text-slate-400 border-b border-slate-200 dark:border-slate-700"><th class="pb-2">Colonna</th><th class="pb-2">Tipo</th><th class="pb-2">Note</th></tr></thead>
                    <tbody class="text-slate-600 dark:text-slate-300">
                        <tr><td class="py-1 pk">id</td><td>INT AUTO_INCREMENT</td><td>PRIMARY KEY</td></tr>
                        <tr><td class="py-1 fk">project_id</td><td>INT</td><td>FK &rarr; sa_projects(id) CASCADE</td></tr>
                        <tr><td class="py-1 fk">session_id</td><td>INT</td><td>FK &rarr; sa_crawl_sessions(id) SET NULL</td></tr>
                        <tr><td class="py-1 fk">user_id</td><td>INT</td><td>FK &rarr; users(id)</td></tr>
                        <tr><td class="py-1">type</td><td>ENUM('crawl','wordpress')</td><td>DEFAULT 'crawl'</td></tr>
                        <tr><td class="py-1">status</td><td>ENUM('pending','running','completed','error','cancelled')</td><td>DEFAULT 'pending'</td></tr>
                        <tr><td class="py-1">config</td><td>JSON</td><td>Configurazione job (crawl_mode, max_pages, connector_id, etc.)</td></tr>
                        <tr><td class="py-1">items_total</td><td>INT</td><td>DEFAULT 0</td></tr>
                        <tr><td class="py-1">items_completed</td><td>INT</td><td>DEFAULT 0</td></tr>
                        <tr><td class="py-1">items_failed</td><td>INT</td><td>DEFAULT 0</td></tr>
                        <tr><td class="py-1">current_item</td><td>VARCHAR(500)</td><td>URL in lavorazione</td></tr>
                        <tr><td class="py-1">error_message</td><td>TEXT</td><td>Messaggio errore</td></tr>
                        <tr><td class="py-1">started_at</td><td>TIMESTAMP</td><td>NULL</td></tr>
                        <tr><td class="py-1">completed_at</td><td>TIMESTAMP</td><td>NULL</td></tr>
                        <tr><td class="py-1">created_at</td><td>TIMESTAMP</td><td>DEFAULT CURRENT_TIMESTAMP</td></tr>
                    </tbody>
                </table>
            </div>
        </details>
        <details class="mt-2 bg-white dark:bg-slate-800 rounded-lg border border-emerald-200 dark:border-emerald-900/50 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white">sa_site_config &middot; sa_activity_logs</summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-600 dark:text-slate-300 space-y-3">
                <div><strong class="text-slate-900 dark:text-white">sa_site_config</strong>: id(PK), project_id(FK UK), robots_txt, robots_allows/disallows(JSON), sitemap_urls(JSON), discovered_urls(JSON), has_sitemap, has_robots, is_https, ssl_valid</div>
                <div><strong class="text-slate-900 dark:text-white">sa_activity_logs</strong>: id(PK), project_id(FK), user_id(FK), action, details(JSON)</div>
            </div>
        </details>
    </section>

    <!-- ==================== SEO TRACKING ==================== -->
    <section id="st" class="mb-16 print-break">
        <h2 class="text-2xl font-bold text-blue-400 mb-6">SEO Tracking (st_)</h2>
        <p class="text-slate-500 dark:text-slate-400 mb-6">16+ tabelle. Monitoraggio posizioni, GSC/GA4 integration, alert, report AI, rank checking.</p>

        <div class="mermaid">
erDiagram
    st_projects ||--o{ st_keywords : "keyword"
    st_projects ||--|| st_gsc_connections : "GSC"
    st_projects ||--|| st_ga4_connections : "GA4"
    st_projects ||--o{ st_gsc_data : "dati GSC"
    st_projects ||--o{ st_ga4_data : "dati GA4"
    st_projects ||--o{ st_alerts : "alert"
    st_projects ||--|| st_alert_settings : "config alert"
    st_projects ||--o{ st_ai_reports : "report"
    st_projects ||--o{ st_rank_jobs : "rank jobs"
    st_keywords ||--o{ st_keyword_positions : "posizioni"
    st_keywords ||--o{ st_gsc_data : "dati query"
    st_keywords ||--o{ st_keyword_revenue : "revenue"
    st_rank_jobs ||--o{ st_rank_queue : "coda"
    st_projects {
        int id PK
        int user_id FK
        varchar domain
        boolean gsc_connected
        boolean ga4_connected
    }
    st_keywords {
        int id PK
        int project_id FK
        varchar keyword UK
        enum priority
        decimal last_position
    }
    st_keyword_positions {
        bigint id PK
        int keyword_id FK
        date date
        decimal avg_position
        int total_clicks
    }
        </div>

        <details class="mt-6 bg-white dark:bg-slate-800 rounded-lg border border-blue-200 dark:border-blue-900/50 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white">st_projects</summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-600 dark:text-slate-300">
                id(PK), user_id(FK), name, domain, gsc_connected, ga4_connected, sync_enabled, last_sync_at, sync_status, ai_reports_enabled, weekly_report_day/time, monthly_report_day, notification_emails(JSON), data_retention_months, created_at, updated_at
            </div>
        </details>
        <details class="mt-2 bg-white dark:bg-slate-800 rounded-lg border border-blue-200 dark:border-blue-900/50 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white">st_keywords</summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-600 dark:text-slate-300">
                id(PK), project_id(FK), keyword(UK con project), keyword_group, is_brand, target_url, priority(high/medium/low), alert_position_change, alert_enabled, last_position, last_clicks, last_impressions, last_ctr, last_updated_at, created_at
            </div>
        </details>
        <details class="mt-2 bg-white dark:bg-slate-800 rounded-lg border border-blue-200 dark:border-blue-900/50 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white">st_gsc_data <span class="text-xs text-slate-400 ml-2">BIGINT PK - tabella ad alto volume</span></summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-600 dark:text-slate-300">
                id(BIGINT PK), project_id(FK), date, query, page, country, device(DESKTOP/MOBILE/TABLET/ALL), clicks, impressions, ctr, position, keyword_id(FK nullable). UK(project, date, query, page, country, device)
            </div>
        </details>
        <details class="mt-2 bg-white dark:bg-slate-800 rounded-lg border border-blue-200 dark:border-blue-900/50 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white">st_keyword_positions &middot; st_keyword_revenue</summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-600 dark:text-slate-300 space-y-3">
                <div><strong class="text-slate-900 dark:text-white">st_keyword_positions</strong> (BIGINT PK): project_id(FK), keyword_id(FK), date, avg_position, best_position, total_clicks, total_impressions, avg_ctr, position/clicks/impressions_change, top_pages(JSON), country_data(JSON). UK(keyword_id, date)</div>
                <div><strong class="text-slate-900 dark:text-white">st_keyword_revenue</strong> (BIGINT PK): project_id(FK), keyword_id(FK nullable), date, query, landing_page, clicks, impressions, position, sessions, revenue, purchases, add_to_carts, revenue_per_click, conversion_rate</div>
            </div>
        </details>
        <details class="mt-2 bg-white dark:bg-slate-800 rounded-lg border border-blue-200 dark:border-blue-900/50 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white">st_gsc_daily &middot; st_ga4_data &middot; st_ga4_daily &middot; Connessioni &middot; Alert &middot; Report &middot; Sync &middot; Rank</summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-600 dark:text-slate-300 space-y-3">
                <div><strong class="text-slate-900 dark:text-white">st_gsc_daily</strong>: project_id(FK), date(UK), total_clicks, total_impressions, avg_ctr, avg_position, unique_queries, unique_pages, changes</div>
                <div><strong class="text-slate-900 dark:text-white">st_ga4_data</strong> (BIGINT): project_id(FK), date, landing_page, source_medium, country, device, sessions, users, new_users, engagement metrics, e-commerce metrics (purchases, revenue)</div>
                <div><strong class="text-slate-900 dark:text-white">st_ga4_daily</strong>: project_id(FK), date(UK), traffic + engagement + e-commerce aggregati giornalieri</div>
                <div><strong class="text-slate-900 dark:text-white">st_gsc_connections</strong>: project_id(FK UK), OAuth tokens, property_url, property_type, is_active, last_sync_at</div>
                <div><strong class="text-slate-900 dark:text-white">st_ga4_connections</strong>: project_id(FK UK), service_account_json, property_id, property_name, is_active</div>
                <div><strong class="text-slate-900 dark:text-white">st_alerts</strong>: project_id(FK), alert_type(9 valori), severity, title, message, keyword_id(FK), previous/current_value, change_percent, ai_analysis, ai_suggestion, status(new/read/actioned/dismissed)</div>
                <div><strong class="text-slate-900 dark:text-white">st_alert_settings</strong>: project_id(FK UK), position/traffic/revenue/anomaly alert config, email_enabled, email_frequency</div>
                <div><strong class="text-slate-900 dark:text-white">st_ai_reports</strong>: project_id(FK), report_type(6 valori), date_from/to, title, summary, content(LONGTEXT), metrics_snapshot(JSON), credits_used, email config, is_scheduled</div>
                <div><strong class="text-slate-900 dark:text-white">st_sync_log</strong>: project_id(FK), sync_type(gsc/ga4/full), date range, records_fetched/inserted/updated, status, duration_seconds</div>
                <div><strong class="text-slate-900 dark:text-white">st_rank_jobs</strong>: project_id(FK), user_id(FK), type(cron/manual), status, keywords_requested/completed/failed/found, current_keyword, avg_position, credits_used</div>
                <div><strong class="text-slate-900 dark:text-white">st_rank_queue</strong>: project_id(FK), keyword_id(FK), keyword, target_domain, location_code, device, status, scheduled_at, result_position, result_url, job_id</div>
            </div>
        </details>
    </section>

    <!-- ==================== KEYWORD RESEARCH ==================== -->
    <section id="kr" class="mb-16 print-break">
        <h2 class="text-2xl font-bold text-purple-400 mb-6">AI Keyword Research (kr_)</h2>
        <p class="text-slate-500 dark:text-slate-400 mb-6">4 tabelle. Research guidata con clustering AI e architettura sito.</p>

        <div class="mermaid">
erDiagram
    kr_projects ||--o{ kr_researches : "ricerche"
    kr_researches ||--o{ kr_clusters : "cluster"
    kr_researches ||--o{ kr_keywords : "keyword"
    kr_clusters ||--o{ kr_keywords : "keyword del cluster"
    kr_projects {
        int id PK
        int user_id FK
        varchar name
        varchar default_location
    }
    kr_researches {
        int id PK
        int project_id FK
        enum type "research/architecture"
        enum status
        json brief
        json ai_response
    }
    kr_clusters {
        int id PK
        int research_id FK
        varchar name
        varchar main_keyword
        varchar intent
    }
    kr_keywords {
        int id PK
        int research_id FK
        int cluster_id FK
        varchar text
        int volume
        varchar intent
    }
        </div>

        <details class="mt-6 bg-white dark:bg-slate-800 rounded-lg border border-purple-200 dark:border-purple-900/50 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white">Tutte le tabelle kr_</summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-600 dark:text-slate-300 space-y-3">
                <div><strong class="text-slate-900 dark:text-white">kr_projects</strong>: id(PK), user_id, name, description, default_location, default_language, created_at, updated_at</div>
                <div><strong class="text-slate-900 dark:text-white">kr_researches</strong>: id(PK), project_id(FK), user_id, type(research/architecture), status(draft/collecting/analyzing/completed/error), brief(JSON), raw_keywords_count, filtered_keywords_count, ai_response(JSON), strategy_note, credits_used, api_time_ms, ai_time_ms</div>
                <div><strong class="text-slate-900 dark:text-white">kr_clusters</strong>: id(PK), research_id(FK), name, main_keyword, main_volume, total_volume, keywords_count, intent, note, suggested_url, suggested_h1, sort_order</div>
                <div><strong class="text-slate-900 dark:text-white">kr_keywords</strong>: id(PK), research_id(FK), cluster_id(FK), text, volume, competition_level, competition_index, low_bid, high_bid, trend, intent, is_main, is_excluded, source</div>
            </div>
        </details>
    </section>

    <!-- ==================== INTERNAL LINKS ==================== -->
    <section id="il" class="mb-16 print-break">
        <h2 class="text-2xl font-bold text-cyan-400 mb-6">Internal Links (il_)</h2>
        <p class="text-slate-500 dark:text-slate-400 mb-6">8 tabelle. Analisi struttura link interni, rilevamento pagine orfane, snapshot storici.</p>

        <div class="mermaid">
erDiagram
    il_projects ||--o{ il_urls : "URL"
    il_projects ||--|| il_project_stats : "stats"
    il_projects ||--o{ il_scrape_sessions : "sessioni"
    il_projects ||--o{ il_snapshots : "snapshot"
    il_urls ||--o{ il_internal_links : "link uscenti"
    il_snapshots ||--o{ il_snapshot_links : "link salvati"
    il_projects {
        int id PK
        int user_id FK
        varchar name
        varchar base_url
    }
    il_urls {
        int id PK
        int project_id FK
        varchar url UK
        enum status
    }
    il_internal_links {
        int id PK
        int source_url_id FK
        varchar destination_url
        varchar anchor_text
        tinyint ai_relevance_score
        enum ai_juice_flow
    }
        </div>

        <details class="mt-6 bg-white dark:bg-slate-800 rounded-lg border border-cyan-200 dark:border-cyan-900/50 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white">Tutte le tabelle il_</summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-600 dark:text-slate-300 space-y-3">
                <div><strong class="text-slate-900 dark:text-white">il_projects</strong>: id(PK), user_id(FK), name, base_url, css_selector, html_block_regex, scrape_delay, user_agent, status, created_at</div>
                <div><strong class="text-slate-900 dark:text-white">il_urls</strong>: id(PK), project_id(FK), url(UK con project), keyword, raw_html, content_html, http_status, scraped_at, status(pending/scraping/scraped/error/no_content), error_message</div>
                <div><strong class="text-slate-900 dark:text-white">il_internal_links</strong>: id(PK), project_id(FK), source_url_id(FK&rarr;il_urls), destination_url, anchor_text, anchor_text_clean, link_position, source_block, is_internal, is_valid, ai_relevance_score(1-10), ai_anchor_quality(1-10), ai_juice_flow(optimal/good/weak/poor/orphan), ai_notes, ai_suggestions, analyzed_at</div>
                <div><strong class="text-slate-900 dark:text-white">il_scrape_sessions</strong>: id(PK), project_id(FK), status(running/paused/completed/stopped), mode(pending/all), total_urls, processed_urls, error_count</div>
                <div><strong class="text-slate-900 dark:text-white">il_snapshots</strong>: id(PK), project_id(FK), user_id(FK), name, description, total_urls/links, internal/external_links, orphan_pages, avg_relevance_score</div>
                <div><strong class="text-slate-900 dark:text-white">il_snapshot_links</strong>: id(PK), snapshot_id(FK), source_url, destination_url, anchor_text, is_internal, ai_relevance_score, ai_juice_flow</div>
                <div><strong class="text-slate-900 dark:text-white">il_project_stats</strong>: project_id(PK FK), total_urls, scraped/error_urls, total/internal/external/analyzed_links, avg_relevance_score, orphan_pages</div>
                <div><strong class="text-slate-900 dark:text-white">il_activity_logs</strong>: id(PK), project_id(FK), user_id(FK), action, details(JSON)</div>
            </div>
        </details>
    </section>

    <!-- ==================== ADS ANALYZER ==================== -->
    <section id="ga" class="mb-16 print-break">
        <h2 class="text-2xl font-bold text-rose-400 mb-6">Google Ads Analyzer (ga_)</h2>
        <p class="text-slate-500 dark:text-slate-400 mb-6">18 tabelle. Analisi negative keywords, valutazione campagne AI, Google Ads Script integration, Campaign Creator AI.</p>

        <div class="mermaid">
erDiagram
    ga_projects ||--o{ ga_script_runs : "runs"
    ga_projects ||--o{ ga_analyses : "analisi"
    ga_projects ||--o{ ga_ad_groups : "ad groups"
    ga_projects ||--o{ ga_campaigns : "campagne"
    ga_projects ||--o{ ga_campaign_evaluations : "valutazioni"
    ga_ad_groups ||--o{ ga_search_terms : "search terms"
    ga_ad_groups ||--o{ ga_negative_categories : "categorie"
    ga_negative_categories ||--o{ ga_negative_keywords : "kw negative"
    ga_script_runs ||--o{ ga_campaigns : "dati campagne"
    ga_script_runs ||--o{ ga_ads : "annunci"
    ga_projects ||--o{ ga_creator_generations : "generazioni"
    ga_projects ||--o{ ga_creator_keywords : "keywords"
    ga_projects ||--o{ ga_creator_campaigns : "campagne AI"
    ga_creator_generations ||--o{ ga_creator_keywords : "keywords"
    ga_creator_generations ||--o{ ga_creator_campaigns : "campagna"
    ga_projects {
        int id PK
        int user_id FK
        enum type "negative-kw/campaign/campaign-creator"
        varchar api_token UK
        varchar landing_url
        enum campaign_type_gads "search/pmax"
        text brief
    }
    ga_analyses {
        int id PK
        int project_id FK
        varchar name
        enum status
    }
    ga_campaign_evaluations {
        int id PK
        int project_id FK
        enum eval_type "manual/auto"
        longtext ai_response
    }
    ga_creator_generations {
        int id PK
        int project_id FK
        int user_id FK
        enum step "keywords/campaign"
        enum status
        longtext ai_response
    }
    ga_creator_keywords {
        int id PK
        int project_id FK
        int generation_id FK
        text keyword
        enum match_type
        int search_volume
        decimal cpc
        varchar competition_level
        int competition_index
        tinyint is_negative
        tinyint is_selected
    }
    ga_creator_campaigns {
        int id PK
        int project_id FK
        int generation_id FK
        enum campaign_type "search/pmax"
        longtext assets_json
    }
        </div>

        <details class="mt-6 bg-white dark:bg-slate-800 rounded-lg border border-rose-200 dark:border-rose-900/50 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white">Negative Keywords: ga_projects &middot; ga_analyses &middot; ga_ad_groups &middot; ga_search_terms &middot; ga_negative_categories &middot; ga_negative_keywords &middot; ga_saved_contexts</summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-600 dark:text-slate-300 space-y-3">
                <div><strong class="text-slate-900 dark:text-white">ga_projects</strong>: id(PK), user_id(FK), type(negative-kw/campaign), name, description, business_context, status, api_token(UK), api_token_created_at, script_config(JSON), auto_evaluate, total_terms, total_negatives_found</div>
                <div><strong class="text-slate-900 dark:text-white">ga_analyses</strong>: id(PK), project_id(FK), user_id(FK), name, business_context, context_mode, status, run_id(FK), total_categories/keywords, error_message, started/completed_at</div>
                <div><strong class="text-slate-900 dark:text-white">ga_ad_groups</strong>: id(PK), project_id(FK), run_id(FK), name, terms_count, zero_ctr_count, wasted_impressions, analysis_status, landing_url, scraped_content, extracted_context</div>
                <div><strong class="text-slate-900 dark:text-white">ga_search_terms</strong>: id(PK), project_id(FK), ad_group_id(FK), run_id(FK), term, match_type, clicks, impressions, ctr, cost, conversions, conversion_value, is_zero_ctr</div>
                <div><strong class="text-slate-900 dark:text-white">ga_negative_categories</strong>: id(PK), project_id(FK), ad_group_id(FK), analysis_id(FK), category_key, category_name, description, priority(high/medium/low), keywords_count, sort_order</div>
                <div><strong class="text-slate-900 dark:text-white">ga_negative_keywords</strong>: id(PK), project_id(FK), ad_group_id(FK), analysis_id(FK), category_id(FK), keyword, is_selected, suggested_match_type</div>
                <div><strong class="text-slate-900 dark:text-white">ga_saved_contexts</strong>: id(PK), user_id(FK), name, context(LONGTEXT)</div>
            </div>
        </details>
        <details class="mt-2 bg-white dark:bg-slate-800 rounded-lg border border-rose-200 dark:border-rose-900/50 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white">Campaign Analysis: ga_script_runs &middot; ga_campaigns &middot; ga_ads &middot; ga_extensions &middot; ga_campaign_evaluations &middot; ga_campaign_ad_groups &middot; ga_ad_group_keywords &middot; ga_auto_eval_queue</summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-600 dark:text-slate-300 space-y-3">
                <div><strong class="text-slate-900 dark:text-white">ga_script_runs</strong>: id(PK), project_id(FK), run_type, status(received/processing/completed/error), items_received, error_message, script_version, date_range</div>
                <div><strong class="text-slate-900 dark:text-white">ga_campaigns</strong>: id(PK), project_id(FK), run_id(FK), campaign_id_google, campaign_name, status/type, bidding_strategy, budget, clicks, impressions, ctr, avg_cpc, cost, conversions, conversion_value, conv_rate</div>
                <div><strong class="text-slate-900 dark:text-white">ga_ads</strong>: id(PK), project_id(FK), run_id(FK), campaign/ad_group IDs, ad_type, headline1-3, description1-2, final_url, path1-2, status, metrics, quality_score</div>
                <div><strong class="text-slate-900 dark:text-white">ga_extensions</strong>: id(PK), project_id(FK), run_id(FK), extension_type, extension_text, status, clicks, impressions</div>
                <div><strong class="text-slate-900 dark:text-white">ga_campaign_evaluations</strong>: id(PK), project_id(FK), user_id(FK), run_id(FK), eval_type(manual/auto), previous_eval_id, name, campaigns/ads/ad_groups/keywords_evaluated, landing_pages_analyzed, ai_response(LONGTEXT), metric_deltas(JSON), campaigns_filter(JSON), status, credits_used</div>
                <div><strong class="text-slate-900 dark:text-white">ga_campaign_ad_groups</strong>: id(PK), project_id(FK), run_id(FK), campaign info, ad_group info, all metrics</div>
                <div><strong class="text-slate-900 dark:text-white">ga_ad_group_keywords</strong>: id(PK), project_id(FK), run_id(FK), campaign/ad_group info, keyword_text, match_type, status, metrics, quality_score, first_page_cpc</div>
                <div><strong class="text-slate-900 dark:text-white">ga_auto_eval_queue</strong>: id(PK), project_id(FK), run_id(FK UK), status(pending/processing/completed/skipped/error), skip_reason, attempts, scheduled_for, timestamps</div>
            </div>
        </details>
        <details class="mt-2 bg-white dark:bg-slate-800 rounded-lg border border-rose-200 dark:border-rose-900/50 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white">Campaign Creator: ga_creator_generations &middot; ga_creator_keywords &middot; ga_creator_campaigns</summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-600 dark:text-slate-300 space-y-3">
                <div><strong class="text-slate-900 dark:text-white">ga_projects (colonne aggiuntive)</strong>: landing_url(VARCHAR 2048), campaign_type_gads(ENUM search/pmax), brief(TEXT), scraped_content(LONGTEXT), scraped_context(TEXT)</div>
                <div><strong class="text-slate-900 dark:text-white">ga_creator_generations</strong>: id(PK), project_id(FK), user_id(FK), step(ENUM keywords/campaign), status(pending/processing/completed/error), ai_response(LONGTEXT), credits_used(DECIMAL), error_message, completed_at</div>
                <div><strong class="text-slate-900 dark:text-white">ga_creator_keywords</strong>: id(PK), project_id(FK), generation_id(FK), keyword(TEXT), match_type(ENUM broad/phrase/exact), ad_group_name, intent, is_negative, is_selected, reason, sort_order, search_volume(INT), cpc(DECIMAL 10,2), competition_level(VARCHAR 20), competition_index(INT)</div>
                <div><strong class="text-slate-900 dark:text-white">ga_creator_campaigns</strong>: id(PK), project_id(FK), generation_id(FK), campaign_type(ENUM search/pmax), campaign_name, assets_json(LONGTEXT  JSON con headlines, descriptions, sitelinks, callouts, structured_snippets, display_paths, business_name)</div>
            </div>
        </details>
    </section>

    <!-- Content Creator (cc_) -->
    <section id="cc" class="mb-16 print-break">
        <h2 class="text-2xl font-bold text-orange-400 mb-6">Content Creator (cc_)</h2>
        <p class="text-slate-500 dark:text-slate-400 mb-6">5 tabelle. Generazione massiva di contenuti HTML per pagine prodotto, categorie, servizi e articoli con AI. Import da CSV, Sitemap, CMS (WordPress, Shopify, PrestaShop, Magento) e Keyword Research. Export su CMS o CSV.</p>

        <div class="mermaid">
erDiagram
    cc_projects ||--o{ cc_urls : "contiene"
    cc_projects ||--o{ cc_jobs : "background jobs"
    cc_projects ||--o{ cc_operations_log : "audit log"
    cc_projects }o--o| cc_connectors : "connettore CMS"
    cc_urls }o--o| cc_connectors : "importato da"
    cc_urls ||--o{ cc_operations_log : "operazioni"

    cc_projects {
        int id PK
        int user_id FK
        varchar name
        enum content_type "product/category/article/service/custom"
        varchar language
        varchar tone
        json ai_settings
        int connector_id FK
        enum status "active/paused/archived"
    }
    cc_urls {
        int id PK
        int project_id FK
        int user_id FK
        varchar url
        varchar keyword
        json secondary_keywords
        varchar intent
        enum source_type "manual/csv/sitemap/cms/keyword_research"
        longtext scraped_content
        longtext ai_content
        varchar ai_h1
        enum status "pending/scraped/generated/approved/rejected/published/error"
        int connector_id FK
        varchar cms_entity_id
        varchar cms_entity_type
        datetime cms_synced_at
    }
    cc_connectors {
        int id PK
        int user_id FK
        varchar name
        enum type "wordpress/shopify/prestashop/magento/custom_api"
        json config
        tinyint is_active
        enum last_test_status "success/error"
        json categories_cache
    }
    cc_jobs {
        int id PK
        int project_id FK
        int user_id FK
        enum type "scrape/generate/cms_push"
        enum status "pending/running/completed/error/cancelled"
        int items_requested
        int items_completed
        decimal credits_used
    }
    cc_operations_log {
        int id PK
        int user_id FK
        int project_id FK
        int url_id FK
        enum operation "scrape/ai_generate/cms_push/export"
        decimal credits_used
        enum status "success/error"
        json details
    }
        </div>

        <details class="mt-6 bg-white dark:bg-slate-800 rounded-lg border border-orange-200 dark:border-orange-900/50 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white">Progetto e URL: cc_projects &middot; cc_urls</summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-600 dark:text-slate-300 space-y-3">
                <div><strong class="text-slate-900 dark:text-white">cc_projects</strong>: id(PK), user_id(FK&rarr;users), name, description, base_url, content_type(ENUM product/category/article/service/custom), language(default:it), tone(default:professionale), ai_settings(JSON), connector_id(FK&rarr;cc_connectors NULL), status(active/paused/archived), created_at, updated_at</div>
                <div><strong class="text-slate-900 dark:text-white">cc_urls</strong>: id(PK), project_id(FK), user_id(FK), url, slug, keyword, secondary_keywords(JSON), intent, source_type(ENUM manual/csv/sitemap/cms/keyword_research), category, scraped_title, scraped_h1, scraped_meta_title, scraped_meta_description, scraped_content(LONGTEXT), scraped_price, scraped_word_count, scraped_at, scrape_error, ai_content(LONGTEXT), ai_h1, ai_word_count, ai_generated_at, ai_error, status(ENUM pending/scraped/generated/approved/rejected/published/error), connector_id(FK&rarr;cc_connectors NULL), cms_entity_id, cms_entity_type, cms_synced_at, cms_sync_error, created_at, updated_at</div>
            </div>
        </details>
        <details class="mt-2 bg-white dark:bg-slate-800 rounded-lg border border-orange-200 dark:border-orange-900/50 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white">Connettori CMS: cc_connectors</summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-600 dark:text-slate-300 space-y-3">
                <div><strong class="text-slate-900 dark:text-white">cc_connectors</strong>: id(PK), user_id(FK&rarr;users), name, type(ENUM wordpress/shopify/prestashop/magento/custom_api), config(JSON &mdash; credenziali specifiche per tipo: url+api_key per PS/WP, store_domain+access_token per Shopify, etc.), api_key, is_active(default:1), last_test_at, last_test_status(success/error), last_sync_at, categories_cache(JSON), seo_plugin, created_at, updated_at</div>
            </div>
        </details>
        <details class="mt-2 bg-white dark:bg-slate-800 rounded-lg border border-orange-200 dark:border-orange-900/50 shadow-sm">
            <summary class="p-4 font-semibold text-slate-900 dark:text-white">Jobs e Log: cc_jobs &middot; cc_operations_log</summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-600 dark:text-slate-300 space-y-3">
                <div><strong class="text-slate-900 dark:text-white">cc_jobs</strong>: id(PK), project_id(FK), user_id(FK), type(ENUM scrape/generate/cms_push), status(ENUM pending/running/completed/error/cancelled), items_requested, items_completed, items_failed, credits_used(DECIMAL 8,2), current_item, current_item_id, error_message, started_at, completed_at, created_at</div>
                <div><strong class="text-slate-900 dark:text-white">cc_operations_log</strong>: id(PK), user_id(FK), project_id(FK), url_id(FK NULL), operation(ENUM scrape/ai_generate/cms_push/export), credits_used(DECIMAL 8,2), status(ENUM success/error), details(JSON), created_at</div>
            </div>
        </details>
    </section>

    <!-- Footer -->
    <footer class="mt-16 pt-8 border-t border-slate-200 dark:border-slate-700 text-center text-sm text-slate-500 dark:text-slate-500">
        <p>Ainstein SEO Toolkit &mdash; Data Model v1.2 &mdash; Aggiornato il 24 Febbraio 2026</p>
        <p class="mt-1">Per stampare come PDF: Ctrl+P &rarr; Salva come PDF (layout A4 Landscape consigliato)</p>
    </footer>

</main>

</body>
</html>
